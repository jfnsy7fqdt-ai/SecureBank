<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SecureBank | Надежный банкинг</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800;900&family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --primary: #00a3ff;
            --primary-dark: #0077cc;
            --primary-glow: rgba(0, 163, 255, 0.5);
            --secondary: #7700ff;
            --secondary-dark: #5500bb;
            --secondary-glow: rgba(119, 0, 255, 0.5);
            --dark-bg: #0a0a0f;
            --dark-card: #111122;
            --dark-card-hover: #1a1a33;
            --text-primary: #ffffff;
            --text-secondary: #a0a0ff;
            --border-color: #222244;
            --glow: 0 0 20px;
            --danger: #ff3366;
            --success: #00ff99;
            --warning: #ffcc00;
            --shadow: 0 10px 30px rgba(0, 0, 0, 0.7);
            --transition: all 0.3s ease;
            --neon-glow: 0 0 15px, 0 0 30px;
        }
        
        body {
            font-family: 'Roboto', sans-serif;
            background-color: var(--dark-bg);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
            background: radial-gradient(circle at 20% 30%, #111133 0%, #0a0a0f 70%);
        }
        
        h1, h2, h3, h4, h5, h6 {
            font-family: 'Montserrat', sans-serif;
            font-weight: 800;
            letter-spacing: 0.5px;
        }
        
        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        /* Header */
        header {
            background: linear-gradient(180deg, rgba(10, 10, 15, 0.95) 0%, rgba(17, 17, 34, 0.9) 100%);
            box-shadow: var(--shadow), 0 0 30px rgba(0, 163, 255, 0.2);
            position: sticky;
            top: 0;
            z-index: 1000;
            animation: slideDown 0.5s ease-out;
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(0, 163, 255, 0.2);
        }
        
        @keyframes slideDown {
            from { transform: translateY(-100%); }
            to { transform: translateY(0); }
        }
        
        .header-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.8rem;
            font-weight: 900;
            color: var(--text-primary);
            text-decoration: none;
            text-shadow: 0 0 10px var(--primary-glow);
        }
        
        .logo i {
            font-size: 2.2rem;
            color: var(--primary);
            text-shadow: var(--glow) var(--primary-glow);
        }
        
        .logo span {
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .nav-links {
            display: flex;
            gap: 30px;
        }
        
        .nav-links a {
            text-decoration: none;
            color: var(--text-secondary);
            font-weight: 500;
            transition: var(--transition);
            position: relative;
            padding: 5px 0;
            font-size: 1.1rem;
        }
        
        .nav-links a:hover, .nav-links a.active {
            color: var(--text-primary);
            text-shadow: 0 0 10px var(--primary-glow);
        }
        
        .nav-links a.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            border-radius: 2px;
            box-shadow: 0 0 10px var(--primary-glow);
        }
        
        .auth-buttons {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 15px;
            background: linear-gradient(135deg, rgba(0, 163, 255, 0.1), rgba(119, 0, 255, 0.1));
            border-radius: 12px;
            border: 1px solid rgba(0, 163, 255, 0.3);
            backdrop-filter: blur(10px);
            box-shadow: 0 0 15px rgba(0, 163, 255, 0.2);
        }
        
        .user-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            box-shadow: 0 0 10px var(--primary-glow);
        }
        
        .user-name {
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .logout-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 1.2rem;
            transition: var(--transition);
            padding: 5px;
            border-radius: 4px;
        }
        
        .logout-btn:hover {
            color: var(--danger);
            background-color: rgba(255, 51, 102, 0.1);
            transform: rotate(90deg);
        }
        
        /* Основные стили кнопок для всех разделов */
        .btn {
            padding: 12px 24px;
            border-radius: 12px;
            border: none;
            font-weight: 700;
            cursor: pointer;
            transition: var(--transition);
            font-size: 1rem;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            letter-spacing: 0.5px;
            position: relative;
            overflow: hidden;
            text-transform: uppercase;
            backdrop-filter: blur(10px);
        }
        
        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: 0.5s;
        }
        
        .btn:hover::before {
            left: 100%;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            box-shadow: 0 0 20px var(--primary-glow);
            border: 1px solid rgba(0, 163, 255, 0.3);
        }
        
        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 25px var(--primary-glow), 0 0 40px var(--secondary-glow);
            border-color: rgba(0, 163, 255, 0.6);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, var(--secondary), var(--primary));
            color: white;
            border: 1px solid rgba(119, 0, 255, 0.3);
        }
        
        .btn-secondary:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 25px var(--secondary-glow);
            border-color: rgba(119, 0, 255, 0.6);
        }
        
        .btn-outline {
            background-color: transparent;
            color: var(--primary);
            border: 2px solid var(--primary);
            box-shadow: 0 0 10px var(--primary-glow);
        }
        
        .btn-outline:hover {
            background-color: rgba(0, 163, 255, 0.1);
            box-shadow: 0 0 20px var(--primary-glow);
            transform: translateY(-3px);
            border-color: rgba(0, 163, 255, 0.6);
        }
        
        /* Кнопки в разделе Карты */
        .card-action-btn {
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.2);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
            backdrop-filter: blur(5px);
        }
        
        .card-action-btn:hover {
            background: rgba(0, 163, 255, 0.5);
            border-color: var(--primary);
            transform: scale(1.2);
            box-shadow: 0 0 15px var(--primary-glow);
        }
        
        /* Кнопки в карусели транзакций */
        .carousel-btn {
            background: linear-gradient(135deg, rgba(0, 163, 255, 0.2), rgba(119, 0, 255, 0.2));
            border: 1px solid rgba(0, 163, 255, 0.3);
            width: 45px;
            height: 45px;
            border-radius: 50%;
            color: var(--text-primary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
            backdrop-filter: blur(5px);
        }
        
        .carousel-btn:hover {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            transform: scale(1.1);
            box-shadow: 0 0 20px var(--primary-glow);
        }
        
        /* Кнопки в разделе Инвестиции */
        .refresh-btn {
            background: linear-gradient(135deg, rgba(0, 163, 255, 0.1), rgba(119, 0, 255, 0.1));
            border: 1px solid rgba(0, 163, 255, 0.3);
            color: var(--primary);
            border-radius: 12px;
            padding: 10px 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
            transition: var(--transition);
            backdrop-filter: blur(5px);
            font-size: 0.9rem;
        }
        
        .refresh-btn:hover {
            background: linear-gradient(135deg, rgba(0, 163, 255, 0.2), rgba(119, 0, 255, 0.2));
            box-shadow: 0 0 15px var(--primary-glow);
            transform: translateY(-2px);
            border-color: rgba(0, 163, 255, 0.6);
        }
        
        .trade-btn {
            padding: 10px 20px;
            border-radius: 10px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.9rem;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            backdrop-filter: blur(5px);
            border: 1px solid transparent;
        }
        
        .trade-btn.buy {
            background: linear-gradient(135deg, rgba(0, 255, 153, 0.2), rgba(0, 255, 153, 0.4));
            color: var(--success);
            border-color: rgba(0, 255, 153, 0.3);
        }
        
        .trade-btn.buy:hover {
            background: linear-gradient(135deg, var(--success), #00cc88);
            color: white;
            box-shadow: 0 0 15px rgba(0, 255, 153, 0.4);
            transform: translateY(-2px);
            border-color: rgba(0, 255, 153, 0.6);
        }
        
        .trade-btn.sell {
            background: linear-gradient(135deg, rgba(255, 51, 102, 0.2), rgba(255, 51, 102, 0.4));
            color: var(--danger);
            border-color: rgba(255, 51, 102, 0.3);
        }
        
        .trade-btn.sell:hover {
            background: linear-gradient(135deg, var(--danger), #cc2952);
            color: white;
            box-shadow: 0 0 15px rgba(255, 51, 102, 0.4);
            transform: translateY(-2px);
            border-color: rgba(255, 51, 102, 0.6);
        }
        
        .trade-type-btn {
            flex: 1;
            padding: 12px;
            text-align: center;
            border-radius: 8px;
            border: none;
            background: rgba(255, 255, 255, 0.05);
            color: var(--text-secondary);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .trade-type-btn.active {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            box-shadow: 0 0 15px var(--primary-glow);
            border-color: rgba(0, 163, 255, 0.6);
        }
        
        .trade-type-btn:hover:not(.active) {
            background: rgba(0, 163, 255, 0.1);
            color: var(--text-primary);
            border-color: rgba(0, 163, 255, 0.3);
        }
        
        .amount-btn {
            flex: 1;
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-primary);
            cursor: pointer;
            transition: var(--transition);
            backdrop-filter: blur(5px);
        }
        
        .amount-btn:hover {
            background: linear-gradient(135deg, rgba(0, 163, 255, 0.1), rgba(119, 0, 255, 0.1));
            border-color: rgba(0, 163, 255, 0.3);
            box-shadow: 0 0 10px var(--primary-glow);
            transform: translateY(-2px);
        }
        
        /* Кнопки в портфеле */
        .portfolio-actions {
            display: flex;
            gap: 8px;
        }
        
        .portfolio-actions .trade-btn {
            padding: 8px 12px;
            border-radius: 8px;
        }
        
        /* Кнопки в модальных окнах */
        .close-modal {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 2rem;
            cursor: pointer;
            transition: var(--transition);
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            backdrop-filter: blur(5px);
        }
        
        .close-modal:hover {
            color: var(--danger);
            background-color: rgba(255, 51, 102, 0.1);
            transform: rotate(90deg);
        }
        
        /* Main Content Sections */
        .content-section {
            display: none;
            animation: fadeIn 0.5s ease-out;
        }
        
        .content-section.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Hero Section */
        .hero {
            padding: 100px 0 80px;
            background: radial-gradient(circle at 80% 20%, rgba(0, 163, 255, 0.1) 0%, transparent 50%),
                        radial-gradient(circle at 20% 80%, rgba(119, 0, 255, 0.1) 0%, transparent 50%);
            position: relative;
            overflow: hidden;
        }
        
        .hero::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 50% 50%, rgba(0, 163, 255, 0.05) 0%, transparent 70%),
                repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(0, 163, 255, 0.03) 2px, rgba(0, 163, 255, 0.03) 4px);
            pointer-events: none;
        }
        
        .hero-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 40px;
            position: relative;
            z-index: 1;
        }
        
        .hero-text {
            flex: 1;
        }
        
        .hero-text h1 {
            font-size: 3.5rem;
            margin-bottom: 20px;
            line-height: 1.2;
            background: linear-gradient(90deg, var(--text-primary), var(--primary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 0 30px rgba(0, 163, 255, 0.3);
        }
        
        .hero-text p {
            font-size: 1.3rem;
            color: var(--text-secondary);
            margin-bottom: 30px;
            max-width: 600px;
            line-height: 1.8;
        }
        
        .hero-image {
            flex: 1;
            display: flex;
            justify-content: center;
            position: relative;
        }
        
        .hero-image img {
            max-width: 100%;
            border-radius: 20px;
            box-shadow: var(--shadow), 0 0 50px rgba(0, 163, 255, 0.3);
            border: 1px solid rgba(0, 163, 255, 0.3);
            animation: float 3s ease-in-out infinite;
            backdrop-filter: blur(10px);
        }
        
        @keyframes float {
            0% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(1deg); }
            100% { transform: translateY(0) rotate(0deg); }
        }
        
        /* Cards Section */
        .cards-section {
            padding: 80px 0;
            position: relative;
        }
        
        .cards-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 30% 70%, rgba(0, 163, 255, 0.05) 0%, transparent 70%);
            pointer-events: none;
        }
        
        .cards-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 50px;
        }
        
        .section-title {
            font-size: 2.8rem;
            position: relative;
            display: inline-block;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 0 20px rgba(0, 163, 255, 0.3);
        }
        
        .section-title::after {
            content: '';
            position: absolute;
            bottom: -15px;
            left: 0;
            width: 100px;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            border-radius: 2px;
            box-shadow: 0 0 15px var(--primary-glow);
        }
        
        /* Cards Grid */
        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(380px, 1fr));
            gap: 30px;
            margin-bottom: 50px;
        }
        
        .card-widget {
            background: linear-gradient(135deg, rgba(17, 17, 34, 0.9), rgba(34, 34, 68, 0.9));
            border-radius: 20px;
            padding: 25px;
            box-shadow: var(--shadow), 0 0 30px rgba(0, 163, 255, 0.1);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
            min-height: 240px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            border: 1px solid rgba(0, 163, 255, 0.2);
            backdrop-filter: blur(10px);
        }
        
        .card-widget::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, transparent, rgba(0, 163, 255, 0.1), transparent);
            transform: translateX(-100%);
        }
        
        .card-widget:hover::before {
            animation: shimmer 1.5s ease;
        }
        
        @keyframes shimmer {
            100% { transform: translateX(100%); }
        }
        
        .card-widget:hover {
            transform: translateY(-10px) scale(1.02);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.8), 0 0 50px rgba(0, 163, 255, 0.3);
            border-color: rgba(0, 163, 255, 0.4);
        }
        
        .card-widget.visa {
            background: linear-gradient(135deg, rgba(26, 35, 126, 0.9), rgba(63, 81, 181, 0.9));
            border-color: rgba(63, 81, 181, 0.4);
        }
        
        .card-widget.mastercard {
            background: linear-gradient(135deg, rgba(255, 111, 0, 0.9), rgba(255, 143, 0, 0.9));
            border-color: rgba(255, 143, 0, 0.4);
        }
        
        .card-widget.mir {
            background: linear-gradient(135deg, rgba(30, 136, 229, 0.9), rgba(21, 101, 192, 0.9));
            border-color: rgba(21, 101, 192, 0.4);
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }
        
        .card-type {
            font-weight: 800;
            font-size: 1.5rem;
            letter-spacing: 1px;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
        }
        
        .card-chip {
            width: 45px;
            height: 35px;
            background: linear-gradient(135deg, #ffd54f, #ffb300);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #333;
            box-shadow: 0 0 10px rgba(255, 213, 79, 0.5);
        }
        
        .card-number {
            font-size: 1.7rem;
            letter-spacing: 3px;
            margin-bottom: 25px;
            font-family: 'Courier New', monospace;
            font-weight: 600;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.2);
        }
        
        .card-footer {
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
        }
        
        .card-info {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .card-label {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.7);
            letter-spacing: 0.5px;
        }
        
        .card-expiry {
            font-size: 1.3rem;
            font-weight: 700;
            letter-spacing: 1px;
        }
        
        .card-balance {
            font-size: 2rem;
            font-weight: 900;
            background: linear-gradient(90deg, #fff, #a0a0ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .card-actions {
            position: absolute;
            top: 15px;
            right: 15px;
            display: flex;
            gap: 10px;
            opacity: 0;
            transition: var(--transition);
        }
        
        .card-widget:hover .card-actions {
            opacity: 1;
        }
        
        /* Add Card Widget */
        .add-card-widget {
            background: linear-gradient(135deg, rgba(17, 17, 34, 0.7), rgba(34, 34, 68, 0.7));
            border: 2px dashed rgba(0, 163, 255, 0.5);
            border-radius: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            min-height: 240px;
            backdrop-filter: blur(10px);
        }
        
        .add-card-widget:hover {
            border-color: var(--primary);
            background: linear-gradient(135deg, rgba(0, 163, 255, 0.1), rgba(119, 0, 255, 0.1));
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 0 40px rgba(0, 163, 255, 0.3);
        }
        
        .add-card-icon {
            font-size: 4rem;
            color: var(--primary);
            margin-bottom: 20px;
            text-shadow: 0 0 20px var(--primary-glow);
        }
        
        .add-card-text {
            font-size: 1.5rem;
            font-weight: 700;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        /* Transactions Carousel Widget */
        .transactions-carousel {
            background: linear-gradient(135deg, rgba(17, 17, 34, 0.9), rgba(34, 34, 68, 0.9));
            border-radius: 20px;
            padding: 35px;
            box-shadow: var(--shadow), 0 0 30px rgba(0, 163, 255, 0.1);
            margin-top: 40px;
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(0, 163, 255, 0.2);
            backdrop-filter: blur(10px);
        }
        
        .carousel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }
        
        .carousel-title {
            font-size: 2rem;
            display: flex;
            align-items: center;
            gap: 15px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .carousel-nav {
            display: flex;
            gap: 10px;
        }
        
        .carousel-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .carousel-btn:disabled:hover {
            background: linear-gradient(135deg, rgba(0, 163, 255, 0.2), rgba(119, 0, 255, 0.2));
            transform: none;
            box-shadow: none;
        }
        
        .carousel-container {
            position: relative;
            height: 320px;
            overflow: hidden;
        }
        
        .carousel-slide {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            transform: translateX(100%);
            transition: transform 0.5s ease, opacity 0.5s ease;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        
        .carousel-slide.active {
            opacity: 1;
            transform: translateX(0);
        }
        
        .carousel-slide.prev {
            transform: translateX(-100%);
        }
        
        .slide-content {
            flex: 1;
        }
        
        .slide-title {
            font-size: 1.8rem;
            margin-bottom: 25px;
            color: var(--primary);
            text-shadow: 0 0 15px var(--primary-glow);
        }
        
        .transactions-list {
            list-style: none;
        }
        
        .transaction-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 18px 0;
            border-bottom: 1px solid rgba(0, 163, 255, 0.2);
            transition: var(--transition);
        }
        
        .transaction-item:hover {
            background: rgba(0, 163, 255, 0.05);
            padding-left: 10px;
            padding-right: 10px;
            border-radius: 10px;
            transform: translateX(5px);
        }
        
        .transaction-item:last-child {
            border-bottom: none;
        }
        
        .transaction-info h4 {
            margin-bottom: 5px;
            font-weight: 600;
        }
        
        .transaction-info p {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }
        
        .transaction-amount.positive {
            color: var(--success);
            font-weight: 700;
            text-shadow: 0 0 10px rgba(0, 255, 153, 0.3);
        }
        
        .transaction-amount.negative {
            color: var(--danger);
            font-weight: 700;
            text-shadow: 0 0 10px rgba(255, 51, 102, 0.3);
        }
        
        .slide-indicators {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
        }
        
        .indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background-color: rgba(0, 163, 255, 0.3);
            cursor: pointer;
            transition: var(--transition);
        }
        
        .indicator.active {
            background-color: var(--primary);
            transform: scale(1.5);
            box-shadow: 0 0 15px var(--primary-glow);
        }
        
        /* Stats Widget */
        .stats-widget {
            display: flex;
            justify-content: space-between;
            margin-top: 25px;
            padding-top: 25px;
            border-top: 1px solid rgba(0, 163, 255, 0.2);
        }
        
        .stat-item {
            text-align: center;
            flex: 1;
        }
        
        .stat-value {
            font-size: 2.2rem;
            font-weight: 900;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }
        
        .stat-value.income {
            color: var(--success);
            text-shadow: 0 0 15px rgba(0, 255, 153, 0.3);
        }
        
        .stat-value.expenses {
            color: var(--danger);
            text-shadow: 0 0 15px rgba(255, 51, 102, 0.3);
        }
        
        .stat-value.balance {
            color: var(--primary);
            text-shadow: 0 0 15px var(--primary-glow);
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.3s ease-out;
            backdrop-filter: blur(10px);
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: linear-gradient(135deg, rgba(17, 17, 34, 0.95), rgba(34, 34, 68, 0.95));
            border-radius: 20px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.8), 0 0 50px rgba(0, 163, 255, 0.3);
            animation: slideUp 0.4s ease-out;
            border: 1px solid rgba(0, 163, 255, 0.3);
            backdrop-filter: blur(20px);
            overflow: hidden;
        }
        
        @keyframes slideUp {
            from { transform: translateY(30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .modal-header {
            padding: 25px 30px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(0, 163, 255, 0.3);
            background: linear-gradient(90deg, rgba(0, 163, 255, 0.1), rgba(119, 0, 255, 0.1));
        }
        
        .modal-title {
            font-size: 1.8rem;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .modal-body {
            padding: 25px 30px 30px;
        }
        
        /* Card preview in add card modal */
        .card-preview {
            background: linear-gradient(135deg, rgba(17, 17, 34, 0.9), rgba(34, 34, 68, 0.9));
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 25px;
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(0, 163, 255, 0.3);
            box-shadow: 0 0 20px rgba(0, 163, 255, 0.2);
            min-height: 180px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        
        .card-preview.visa {
            background: linear-gradient(135deg, rgba(26, 35, 126, 0.9), rgba(63, 81, 181, 0.9));
        }
        
        .card-preview.mastercard {
            background: linear-gradient(135deg, rgba(255, 111, 0, 0.9), rgba(255, 143, 0, 0.9));
        }
        
        .card-preview.mir {
            background: linear-gradient(135deg, rgba(30, 136, 229, 0.9), rgba(21, 101, 192, 0.9));
        }
        
        .card-preview-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .card-preview-type {
            font-weight: 700;
            font-size: 1.3rem;
            color: white;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
        }
        
        .card-preview-chip {
            width: 40px;
            height: 30px;
            background: linear-gradient(135deg, #ffd54f, #ffb300);
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(255, 213, 79, 0.5);
        }
        
        .card-preview-number {
            font-size: 1.5rem;
            letter-spacing: 2px;
            margin-bottom: 15px;
            font-family: 'Courier New', monospace;
            font-weight: 600;
            color: white;
            text-align: center;
        }
        
        .card-preview-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .card-preview-expiry {
            color: white;
            font-weight: 600;
            font-size: 1.1rem;
        }
        
        /* Улучшенная функция определения типа карты */
        .card-type-badge {
            position: absolute;
            top: 15px;
            right: 15px;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .card-type-badge.visa {
            background: rgba(63, 81, 181, 0.9);
            color: white;
            box-shadow: 0 0 10px rgba(63, 81, 181, 0.5);
        }
        
        .card-type-badge.mastercard {
            background: rgba(255, 143, 0, 0.9);
            color: white;
            box-shadow: 0 0 10px rgba(255, 143, 0, 0.5);
        }
        
        .card-type-badge.mir {
            background: rgba(21, 101, 192, 0.9);
            color: white;
            box-shadow: 0 0 10px rgba(21, 101, 192, 0.5);
        }
        
        /* Transfer Section */
        .transfers-section {
            padding: 80px 0;
            position: relative;
        }
        
        .transfers-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 70% 30%, rgba(119, 0, 255, 0.05) 0%, transparent 70%);
            pointer-events: none;
        }
        
        .transfers-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 50px;
        }
        
        /* Transfers Container */
        .transfers-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
        }
        
        @media (max-width: 992px) {
            .transfers-container {
                grid-template-columns: 1fr;
            }
        }
        
        /* Transfer Form */
        .transfer-form-container {
            background: linear-gradient(135deg, rgba(17, 17, 34, 0.9), rgba(34, 34, 68, 0.9));
            border-radius: 20px;
            padding: 35px;
            box-shadow: var(--shadow), 0 0 30px rgba(0, 163, 255, 0.1);
            border: 1px solid rgba(0, 163, 255, 0.2);
            backdrop-filter: blur(10px);
        }
        
        .transfer-form-title {
            font-size: 2rem;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 15px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .transfer-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .form-group {
            margin-bottom: 0;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text-secondary);
        }
        
        .form-control {
            width: 100%;
            padding: 14px 18px;
            background: rgba(10, 10, 15, 0.7);
            border: 1px solid rgba(0, 163, 255, 0.3);
            border-radius: 12px;
            color: var(--text-primary);
            font-size: 1rem;
            transition: var(--transition);
            backdrop-filter: blur(5px);
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 15px var(--primary-glow);
            background: rgba(10, 10, 15, 0.9);
        }
        
        .form-row {
            display: flex;
            gap: 15px;
        }
        
        .form-row .form-group {
            flex: 1;
        }
        
        .user-search-results {
            position: absolute;
            top: 100%;
            left: 0;
            width: 100%;
            background: linear-gradient(135deg, rgba(17, 17, 34, 0.95), rgba(34, 34, 68, 0.95));
            border: 1px solid rgba(0, 163, 255, 0.3);
            border-radius: 12px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 10;
            display: none;
            margin-top: 5px;
            backdrop-filter: blur(20px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.7);
        }
        
        .user-search-results.active {
            display: block;
        }
        
        .user-result {
            padding: 12px 15px;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .user-result:hover {
            background: linear-gradient(90deg, rgba(0, 163, 255, 0.1), rgba(119, 0, 255, 0.1));
        }
        
        .user-avatar-small {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.9rem;
            box-shadow: 0 0 10px var(--primary-glow);
        }
        
        .user-result-info {
            flex: 1;
        }
        
        .user-result-name {
            font-weight: 500;
        }
        
        .user-result-email {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }
        
        /* Transfer Preview */
        .transfer-preview {
            background: linear-gradient(135deg, rgba(0, 163, 255, 0.1), rgba(119, 0, 255, 0.1));
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(0, 163, 255, 0.3);
            margin-top: 20px;
            display: none;
            backdrop-filter: blur(10px);
        }
        
        .transfer-preview.active {
            display: block;
            animation: fadeIn 0.5s ease-out;
        }
        
        .transfer-preview-title {
            font-size: 1.3rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--primary);
        }
        
        .transfer-details {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .transfer-detail {
            display: flex;
            justify-content: space-between;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(0, 163, 255, 0.2);
        }
        
        .transfer-detail:last-child {
            border-bottom: none;
        }
        
        .transfer-label {
            color: var(--text-secondary);
        }
        
        .transfer-value {
            font-weight: 600;
        }
        
        /* Transfer History */
        .transfer-history-container {
            background: linear-gradient(135deg, rgba(17, 17, 34, 0.9), rgba(34, 34, 68, 0.9));
            border-radius: 20px;
            padding: 35px;
            box-shadow: var(--shadow), 0 0 30px rgba(0, 163, 255, 0.1);
            border: 1px solid rgba(0, 163, 255, 0.2);
            backdrop-filter: blur(10px);
        }
        
        .transfer-history-title {
            font-size: 2rem;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 15px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .transfers-list {
            list-style: none;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .transfer-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid rgba(0, 163, 255, 0.2);
            transition: var(--transition);
        }
        
        .transfer-item:hover {
            background: rgba(0, 163, 255, 0.05);
            padding-left: 10px;
            padding-right: 10px;
            border-radius: 10px;
            transform: translateX(5px);
        }
        
        .transfer-item:last-child {
            border-bottom: none;
        }
        
        .transfer-item.outgoing {
            border-left: 4px solid var(--danger);
            padding-left: 10px;
        }
        
        .transfer-item.incoming {
            border-left: 4px solid var(--success);
            padding-left: 10px;
        }
        
        .transfer-info {
            flex: 1;
        }
        
        .transfer-info h4 {
            margin-bottom: 5px;
        }
        
        .transfer-info p {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }
        
        .transfer-amount {
            font-weight: 600;
            font-size: 1.2rem;
        }
        
        .transfer-amount.outgoing {
            color: var(--danger);
            text-shadow: 0 0 10px rgba(255, 51, 102, 0.3);
        }
        
        .transfer-amount.incoming {
            color: var(--success);
            text-shadow: 0 0 10px rgba(0, 255, 153, 0.3);
        }
        
        .empty-history {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-secondary);
        }
        
        .empty-history i {
            font-size: 3rem;
            margin-bottom: 15px;
            opacity: 0.5;
            color: var(--primary);
            text-shadow: 0 0 10px var(--primary-glow);
        }
        
        /* Investments Section */
        .investments-section {
            padding: 80px 0;
            position: relative;
        }
        
        .investments-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 50% 50%, rgba(0, 163, 255, 0.05) 0%, transparent 70%),
                        radial-gradient(circle at 80% 20%, rgba(119, 0, 255, 0.05) 0%, transparent 70%);
            pointer-events: none;
        }
        
        /* Инвестиционный терминал */
        .investments-terminal {
            display: flex;
            gap: 30px;
            margin-top: 30px;
            flex-wrap: wrap;
        }
        
        @media (max-width: 992px) {
            .investments-terminal {
                flex-direction: column;
            }
        }
        
        /* Рыночные данные */
        .market-data {
            flex: 2;
            background: linear-gradient(135deg, rgba(17, 17, 34, 0.9), rgba(34, 34, 68, 0.9));
            border-radius: 20px;
            padding: 35px;
            box-shadow: var(--shadow), 0 0 30px rgba(0, 163, 255, 0.1);
            border: 1px solid rgba(0, 163, 255, 0.2);
            backdrop-filter: blur(10px);
            min-width: 300px;
        }
        
        .market-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }
        
        .market-title {
            font-size: 2rem;
            display: flex;
            align-items: center;
            gap: 15px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .market-controls {
            display: flex;
            gap: 10px;
        }
        
        .refresh-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .refresh-btn:disabled:hover {
            background: linear-gradient(135deg, rgba(0, 163, 255, 0.1), rgba(119, 0, 255, 0.1));
            transform: none;
            box-shadow: none;
        }
        
        .last-update {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-top: 5px;
            margin-bottom: 20px;
        }
        
        /* Таблица криптовалют */
        .crypto-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .crypto-table thead {
            border-bottom: 1px solid rgba(0, 163, 255, 0.3);
        }
        
        .crypto-table th {
            text-align: left;
            padding: 15px 10px;
            font-weight: 600;
            color: var(--text-secondary);
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .crypto-table tbody tr {
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            transition: var(--transition);
            cursor: pointer;
        }
        
        .crypto-table tbody tr:hover {
            background: rgba(0, 163, 255, 0.05);
        }
        
        .crypto-table td {
            padding: 18px 10px;
        }
        
        .crypto-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .crypto-icon {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .crypto-name {
            font-weight: 600;
        }
        
        .crypto-symbol {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }
        
        .crypto-price {
            font-weight: 600;
            font-size: 1.1rem;
        }
        
        .crypto-change {
            font-weight: 600;
            border-radius: 6px;
            padding: 6px 10px;
            font-size: 0.9rem;
            backdrop-filter: blur(5px);
            border: 1px solid transparent;
        }
        
        .crypto-change.positive {
            color: var(--success);
            background: rgba(0, 255, 153, 0.1);
            border-color: rgba(0, 255, 153, 0.2);
        }
        
        .crypto-change.negative {
            color: var(--danger);
            background: rgba(255, 51, 102, 0.1);
            border-color: rgba(255, 51, 102, 0.2);
        }
        
        .crypto-change.neutral {
            color: var(--text-secondary);
            background: rgba(255, 255, 255, 0.05);
            border-color: rgba(255, 255, 255, 0.1);
        }
        
        .crypto-actions {
            display: flex;
            gap: 8px;
        }
        
        /* Панель торговли */
        .trade-panel {
            flex: 1;
            background: linear-gradient(135deg, rgba(17, 17, 34, 0.9), rgba(34, 34, 68, 0.9));
            border-radius: 20px;
            padding: 35px;
            box-shadow: var(--shadow), 0 0 30px rgba(0, 163, 255, 0.1);
            border: 1px solid rgba(0, 163, 255, 0.2);
            backdrop-filter: blur(10px);
            min-width: 300px;
            max-width: 400px;
        }
        
        .trade-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }
        
        .trade-title {
            font-size: 2rem;
            display: flex;
            align-items: center;
            gap: 15px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .selected-crypto {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 25px;
            border: 1px solid rgba(0, 163, 255, 0.3);
            backdrop-filter: blur(5px);
        }
        
        .selected-crypto-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .selected-crypto-details h4 {
            margin-bottom: 5px;
        }
        
        .selected-crypto-details p {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }
        
        .selected-crypto-price {
            font-weight: 600;
            font-size: 1.3rem;
            color: var(--primary);
            text-shadow: 0 0 10px var(--primary-glow);
        }
        
        /* Форма торговли */
        .trade-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .amount-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .form-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }
        
        .form-label {
            color: var(--text-secondary);
        }
        
        .form-value {
            font-weight: 600;
        }
        
        /* Портфель пользователя */
        .portfolio-section {
            margin-top: 40px;
            background: linear-gradient(135deg, rgba(17, 17, 34, 0.9), rgba(34, 34, 68, 0.9));
            border-radius: 20px;
            padding: 35px;
            box-shadow: var(--shadow), 0 0 30px rgba(0, 163, 255, 0.1);
            border: 1px solid rgba(0, 163, 255, 0.2);
            backdrop-filter: blur(10px);
        }
        
        .portfolio-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }
        
        .portfolio-title {
            font-size: 2rem;
            display: flex;
            align-items: center;
            gap: 15px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .portfolio-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .portfolio-stat {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            padding: 25px;
            border: 1px solid rgba(0, 163, 255, 0.2);
            backdrop-filter: blur(5px);
            transition: var(--transition);
        }
        
        .portfolio-stat:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
            border-color: rgba(0, 163, 255, 0.4);
        }
        
        .portfolio-stat-value {
            font-size: 2rem;
            font-weight: 900;
            margin-bottom: 5px;
        }
        
        .portfolio-stat-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }
        
        .portfolio-stat-value.total {
            color: var(--primary);
            text-shadow: 0 0 10px var(--primary-glow);
        }
        
        .portfolio-stat-value.change.positive {
            color: var(--success);
            text-shadow: 0 0 10px rgba(0, 255, 153, 0.3);
        }
        
        .portfolio-stat-value.change.negative {
            color: var(--danger);
            text-shadow: 0 0 10px rgba(255, 51, 102, 0.3);
        }
        
        .portfolio-assets {
            margin-top: 20px;
        }
        
        .portfolio-empty {
            text-align: center;
            padding: 50px 20px;
            color: var(--text-secondary);
        }
        
        .portfolio-empty i {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.5;
            color: var(--primary);
            text-shadow: 0 0 15px var(--primary-glow);
        }
        
        .portfolio-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .portfolio-table th {
            text-align: left;
            padding: 15px 10px;
            font-weight: 600;
            color: var(--text-secondary);
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-bottom: 1px solid rgba(0, 163, 255, 0.3);
        }
        
        .portfolio-table td {
            padding: 18px 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        /* Уведомления */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 20px 25px;
            border-radius: 15px;
            background: linear-gradient(135deg, rgba(17, 17, 34, 0.95), rgba(34, 34, 68, 0.95));
            box-shadow: var(--shadow), 0 0 30px rgba(0, 163, 255, 0.2);
            display: flex;
            align-items: center;
            gap: 15px;
            z-index: 3000;
            transform: translateX(150%);
            transition: transform 0.4s ease;
            max-width: 400px;
            border: 1px solid rgba(0, 163, 255, 0.3);
            backdrop-filter: blur(20px);
            overflow: hidden;
        }
        
        .notification::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
        }
        
        .notification.active {
            transform: translateX(0);
        }
        
        .notification.success {
            border-left: 4px solid var(--success);
        }
        
        .notification.success::before {
            background: var(--success);
            box-shadow: 0 0 10px var(--success);
        }
        
        .notification.error {
            border-left: 4px solid var(--danger);
        }
        
        .notification.error::before {
            background: var(--danger);
            box-shadow: 0 0 10px var(--danger);
        }
        
        .notification.warning {
            border-left: 4px solid var(--warning);
        }
        
        .notification.warning::before {
            background: var(--warning);
            box-shadow: 0 0 10px var(--warning);
        }
        
        .notification-icon {
            font-size: 1.8rem;
        }
        
        .notification.success .notification-icon {
            color: var(--success);
            text-shadow: 0 0 10px rgba(0, 255, 153, 0.3);
        }
        
        .notification.error .notification-icon {
            color: var(--danger);
            text-shadow: 0 0 10px rgba(255, 51, 102, 0.3);
        }
        
        .notification.warning .notification-icon {
            color: var(--warning);
            text-shadow: 0 0 10px rgba(255, 204, 0, 0.3);
        }
        
        .notification-content {
            flex: 1;
        }
        
        .notification-title {
            font-weight: 700;
            font-size: 1.1rem;
            margin-bottom: 5px;
        }
        
        .notification-message {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }
        
        /* Footer - полностью переработан */
        footer {
            background: linear-gradient(180deg, rgba(17, 17, 34, 0.95) 0%, rgba(10, 10, 15, 1) 100%);
            padding: 70px 0 25px;
            margin-top: 80px;
            position: relative;
            border-top: 1px solid rgba(0, 163, 255, 0.2);
        }
        
        footer::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--primary), transparent);
            box-shadow: 0 0 10px var(--primary-glow);
        }
        
        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 50px;
            margin-bottom: 50px;
        }
        
        .footer-column h3 {
            font-size: 1.5rem;
            margin-bottom: 25px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            position: relative;
            display: inline-block;
        }
        
        .footer-column h3::after {
            content: '';
            position: absolute;
            bottom: -8px;
            left: 0;
            width: 50px;
            height: 2px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            border-radius: 1px;
            box-shadow: 0 0 10px var(--primary-glow);
        }
        
        .footer-column p {
            color: var(--text-secondary);
            line-height: 1.7;
            margin-bottom: 20px;
        }
        
        .footer-links {
            list-style: none;
        }
        
        .footer-links li {
            margin-bottom: 12px;
        }
        
        .footer-links a {
            color: var(--text-secondary);
            text-decoration: none;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 5px 0;
            position: relative;
        }
        
        .footer-links a::before {
            content: '▶';
            font-size: 0.7rem;
            color: var(--primary);
            opacity: 0;
            transition: var(--transition);
            text-shadow: 0 0 5px var(--primary-glow);
        }
        
        .footer-links a:hover {
            color: var(--text-primary);
            padding-left: 10px;
            text-shadow: 0 0 5px var(--primary-glow);
        }
        
        .footer-links a:hover::before {
            opacity: 1;
        }
        
        .social-links {
            display: flex;
            gap: 15px;
            margin-top: 25px;
        }
        
        .social-links a {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 45px;
            height: 45px;
            background: linear-gradient(135deg, rgba(0, 163, 255, 0.1), rgba(119, 0, 255, 0.1));
            border-radius: 50%;
            color: var(--text-primary);
            font-size: 1.2rem;
            transition: var(--transition);
            border: 1px solid rgba(0, 163, 255, 0.2);
            backdrop-filter: blur(5px);
        }
        
        .social-links a:hover {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            transform: translateY(-5px) scale(1.1);
            box-shadow: 0 5px 15px var(--primary-glow);
            border-color: rgba(0, 163, 255, 0.5);
        }
        
        .contact-info {
            list-style: none;
        }
        
        .contact-info li {
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 12px;
            color: var(--text-secondary);
        }
        
        .contact-info i {
            color: var(--primary);
            font-size: 1.2rem;
            text-shadow: 0 0 5px var(--primary-glow);
            width: 24px;
        }
        
        .footer-bottom {
            text-align: center;
            padding-top: 25px;
            border-top: 1px solid rgba(0, 163, 255, 0.2);
            color: var(--text-secondary);
            font-size: 0.9rem;
            position: relative;
        }
        
        .footer-bottom::before {
            content: '';
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--primary), transparent);
            box-shadow: 0 0 10px var(--primary-glow);
        }
        
        .footer-bottom p {
            margin: 0;
        }
        
        /* Анимация пульсации для важных элементов */
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(0, 163, 255, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(0, 163, 255, 0); }
            100% { box-shadow: 0 0 0 0 rgba(0, 163, 255, 0); }
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        /* Responsive */
        @media (max-width: 992px) {
            .hero-content {
                flex-direction: column;
                text-align: center;
            }
            
            .hero-text h1 {
                font-size: 2.8rem;
            }
            
            .cards-grid {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 768px) {
            .nav-links {
                display: none;
            }
            
            .hero-text h1 {
                font-size: 2.2rem;
            }
            
            .section-title {
                font-size: 2rem;
            }
            
            .carousel-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            
            .carousel-nav {
                align-self: flex-end;
            }
            
            .footer-content {
                grid-template-columns: 1fr;
                gap: 40px;
            }
            
            .notification {
                max-width: 90%;
                right: 5%;
                left: 5%;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="container header-container">
            <a href="#" class="logo">
                <i class="fas fa-university"></i>
                <span>SecureBank</span>
            </a>
            
            <nav class="nav-links">
                <a href="#" class="active" data-section="home"><i class="fas fa-home"></i> Главная</a>
                <a href="#" data-section="cards"><i class="fas fa-credit-card"></i> Карты</a>
                <a href="#" data-section="transfers"><i class="fas fa-exchange-alt"></i> Переводы</a>
                <a href="#" data-section="investments"><i class="fas fa-chart-line"></i> Инвестиции</a>
                <a href="#"><i class="fas fa-question-circle"></i> Помощь</a>
            </nav>
            
            <div class="auth-buttons" id="authButtons">
                <!-- Показывается когда пользователь не авторизован -->
                <button class="btn btn-outline" id="loginBtn">
                    <i class="fas fa-sign-in-alt"></i> Войти
                </button>
                <button class="btn btn-primary" id="registerBtn">
                    <i class="fas fa-user-plus"></i> Регистрация
                </button>
                
                <!-- Показывается когда пользователь авторизован -->
                <div class="user-info" id="userInfo" style="display: none;">
                    <div class="user-avatar" id="userAvatar">ИИ</div>
                    <div class="user-name" id="userName">Иван Иванов</div>
                    <button class="logout-btn" id="logoutBtn" title="Выйти">
                        <i class="fas fa-sign-out-alt"></i>
                    </button>
                </div>
            </div>
        </div>
    </header>
    
    <!-- Main Content -->
    <main>
        <!-- Home Section -->
        <section class="content-section active" id="homeSection">
            <!-- Hero Section -->
            <section class="hero">
                <div class="container hero-content">
                    <div class="hero-text">
                        <h1>Банкинг будущего уже здесь</h1>
                        <p>Испытайте мощь футуристичных финансовых технологий. Безопасность, скорость и инновации в одном приложении.</p>
                        <div class="auth-buttons" id="heroAuthButtons">
                            <button class="btn btn-primary pulse" id="heroRegisterBtn">
                                <i class="fas fa-rocket"></i> Начать путешествие
                            </button>
                            <button class="btn btn-secondary">
                                <i class="fas fa-mobile-alt"></i> Скачать приложение
                            </button>
                        </div>
                    </div>
                    <div class="hero-image">
                        <img src="https://images.unsplash.com/photo-1551434678-e076c223a692?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=600&q=80" alt="Банковское приложение будущего">
                    </div>
                </div>
            </section>
        </section>
        
        <!-- Cards Section -->
        <section class="content-section" id="cardsSection">
            <div class="container">
                <div class="cards-section">
                    <div class="cards-header">
                        <h2 class="section-title">Мои карты</h2>
                        <button class="btn btn-primary" id="addCardBtn">
                            <i class="fas fa-plus"></i> Добавить карту
                        </button>
                    </div>
                    
                    <!-- Cards Grid -->
                    <div class="cards-grid" id="cardsGrid">
                        <!-- Карты будут добавляться динамически -->
                    </div>
                    
                    <!-- Transactions Carousel -->
                    <div class="transactions-carousel">
                        <div class="carousel-header">
                            <h3 class="carousel-title">
                                <i class="fas fa-exchange-alt"></i> Операции по картам
                            </h3>
                            <div class="carousel-nav">
                                <button class="carousel-btn" id="prevSlide">
                                    <i class="fas fa-chevron-left"></i>
                                </button>
                                <button class="carousel-btn" id="nextSlide">
                                    <i class="fas fa-chevron-right"></i>
                                </button>
                            </div>
                        </div>
                        
                        <div class="carousel-container">
                            <!-- Slide 1: Recent Transactions -->
                            <div class="carousel-slide active" id="slide1">
                                <div class="slide-content">
                                    <h4 class="slide-title">Последние операции</h4>
                                    <ul class="transactions-list" id="recentTransactions">
                                        <!-- Транзакции будут добавляться динамически -->
                                    </ul>
                                </div>
                                <div class="slide-indicators">
                                    <div class="indicator active" data-slide="0"></div>
                                    <div class="indicator" data-slide="1"></div>
                                    <div class="indicator" data-slide="2"></div>
                                </div>
                            </div>
                            
                            <!-- Slide 2: Income -->
                            <div class="carousel-slide" id="slide2">
                                <div class="slide-content">
                                    <h4 class="slide-title">Доходы за месяц</h4>
                                    <ul class="transactions-list" id="incomeTransactions">
                                        <!-- Доходы будут добавляться динамически -->
                                    </ul>
                                </div>
                                <div class="stats-widget">
                                    <div class="stat-item">
                                        <div class="stat-value income" id="totalIncome">$0</div>
                                        <div class="stat-label">Общий доход</div>
                                    </div>
                                    <div class="stat-item">
                                        <div class="stat-value" id="incomeCount">0</div>
                                        <div class="stat-label">Кол-во операций</div>
                                    </div>
                                    <div class="stat-item">
                                        <div class="stat-value" id="largestIncome">$0</div>
                                        <div class="stat-label">Самая крупная</div>
                                    </div>
                                </div>
                                <div class="slide-indicators">
                                    <div class="indicator" data-slide="0"></div>
                                    <div class="indicator active" data-slide="1"></div>
                                    <div class="indicator" data-slide="2"></div>
                                </div>
                            </div>
                            
                            <!-- Slide 3: Expenses -->
                            <div class="carousel-slide" id="slide3">
                                <div class="slide-content">
                                    <h4 class="slide-title">Расходы за месяц</h4>
                                    <ul class="transactions-list" id="expensesTransactions">
                                        <!-- Расходы будут добавляться динамически -->
                                    </ul>
                                </div>
                                <div class="stats-widget">
                                    <div class="stat-item">
                                        <div class="stat-value expenses" id="totalExpenses">$0</div>
                                        <div class="stat-label">Общие расходы</div>
                                    </div>
                                    <div class="stat-item">
                                        <div class="stat-value" id="expensesCount">0</div>
                                        <div class="stat-label">Кол-во операций</div>
                                    </div>
                                    <div class="stat-item">
                                        <div class="stat-value" id="largestExpense">$0</div>
                                        <div class="stat-label">Самая крупная</div>
                                    </div>
                                </div>
                                <div class="slide-indicators">
                                    <div class="indicator" data-slide="0"></div>
                                    <div class="indicator" data-slide="1"></div>
                                    <div class="indicator active" data-slide="2"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Transfers Section -->
        <section class="content-section" id="transfersSection">
            <div class="container">
                <div class="transfers-section">
                    <div class="transfers-header">
                        <h2 class="section-title">Переводы</h2>
                        <button class="btn btn-secondary" id="showTransferHistory">
                            <i class="fas fa-history"></i> Вся история
                        </button>
                    </div>
                    
                    <div class="transfers-container">
                        <!-- Transfer Form -->
                        <div class="transfer-form-container">
                            <h3 class="transfer-form-title">
                                <i class="fas fa-paper-plane"></i> Новый перевод
                            </h3>
                            
                            <form id="transferForm" class="transfer-form">
                                <div class="form-group">
                                    <label for="fromCard">С карты</label>
                                    <select id="fromCard" class="form-control" required>
                                        <option value="">Выберите карту</option>
                                        <!-- Карты будут добавляться динамически -->
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label for="recipientEmail">Получатель (Email)</label>
                                    <input type="email" id="recipientEmail" class="form-control" placeholder="example@mail.com" required>
                                    <div class="user-search-results" id="userSearchResults">
                                        <!-- Результаты поиска пользователей -->
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label for="toCard">На карту получателя</label>
                                    <select id="toCard" class="form-control" required disabled>
                                        <option value="">Сначала выберите получателя</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label for="transferAmount">Сумма перевода ($)</label>
                                    <input type="number" id="transferAmount" class="form-control" placeholder="0.00" min="0.01" step="0.01" required>
                                </div>
                                
                                <div class="form-group">
                                    <label for="transferNote">Примечание (необязательно)</label>
                                    <input type="text" id="transferNote" class="form-control" placeholder="Например: за обед">
                                </div>
                                
                                <button type="submit" class="btn btn-primary" style="width: 100%; padding: 15px; margin-top: 10px;">
                                    <i class="fas fa-paper-plane"></i> Отправить перевод
                                </button>
                            </form>
                            
                            <!-- Transfer Preview -->
                            <div class="transfer-preview" id="transferPreview">
                                <h4 class="transfer-preview-title">
                                    <i class="fas fa-search"></i> Предпросмотр перевода
                                </h4>
                                <div class="transfer-details">
                                    <div class="transfer-detail">
                                        <span class="transfer-label">Отправитель:</span>
                                        <span class="transfer-value" id="previewFrom">-</span>
                                    </div>
                                    <div class="transfer-detail">
                                        <span class="transfer-label">Получатель:</span>
                                        <span class="transfer-value" id="previewTo">-</span>
                                    </div>
                                    <div class="transfer-detail">
                                        <span class="transfer-label">Сумма:</span>
                                        <span class="transfer-value" id="previewAmount">$0.00</span>
                                    </div>
                                    <div class="transfer-detail">
                                        <span class="transfer-label">Комиссия:</span>
                                        <span class="transfer-value" id="previewFee">$0.00</span>
                                    </div>
                                    <div class="transfer-detail">
                                        <span class="transfer-label">Итого к списанию:</span>
                                        <span class="transfer-value" id="previewTotal">$0.00</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Transfer History -->
                        <div class="transfer-history-container">
                            <h3 class="transfer-history-title">
                                <i class="fas fa-history"></i> История переводов
                            </h3>
                            
                            <ul class="transfers-list" id="transfersList">
                                <!-- История переводов будет добавляться динамически -->
                                <div class="empty-history" id="emptyHistory">
                                    <i class="fas fa-exchange-alt"></i>
                                    <h4>История переводов пуста</h4>
                                    <p>Выполните свой первый перевод, чтобы увидеть его здесь</p>
                                </div>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Investments Section -->
        <section class="content-section" id="investmentsSection">
            <div class="container">
                <div class="investments-section">
                    <div class="cards-header">
                        <h2 class="section-title">Инвестиции</h2>
                        <button class="btn btn-primary" id="depositInvestmentBtn">
                            <i class="fas fa-plus-circle"></i> Пополнить счет
                        </button>
                    </div>
                    
                    <!-- Терминал инвестиций -->
                    <div class="investments-terminal">
                        <!-- Рыночные данные -->
                        <div class="market-data">
                            <div class="market-header">
                                <h3 class="market-title">
                                    <i class="fas fa-chart-line"></i> Криптовалюты
                                </h3>
                                <div class="market-controls">
                                    <button class="refresh-btn" id="refreshPricesBtn">
                                        <i class="fas fa-sync-alt"></i> Обновить
                                    </button>
                                </div>
                            </div>
                            
                            <div class="last-update" id="lastUpdateTime">
                                Последнее обновление: загружается...
                            </div>
                            
                            <table class="crypto-table">
                                <thead>
                                    <tr>
                                        <th>Название</th>
                                        <th>Цена (USD)</th>
                                        <th>Изменение 24ч</th>
                                        <th>Действия</th>
                                    </tr>
                                </thead>
                                <tbody id="cryptoTableBody">
                                    <!-- Криптовалюты будут загружены динамически -->
                                </tbody>
                            </table>
                        </div>
                        
                        <!-- Панель торговли -->
                        <div class="trade-panel">
                            <div class="trade-header">
                                <h3 class="trade-title">
                                    <i class="fas fa-exchange-alt"></i> Торговля
                                </h3>
                            </div>
                            
                            <div class="trade-type" id="tradeTypeSelector">
                                <button class="trade-type-btn active" data-type="buy">Купить</button>
                                <button class="trade-type-btn" data-type="sell">Продать</button>
                            </div>
                            
                            <div class="selected-crypto" id="selectedCryptoInfo" style="display: none;">
                                <div class="selected-crypto-info">
                                    <div class="crypto-icon" id="selectedCryptoIcon">
                                        <i class="fab fa-bitcoin"></i>
                                    </div>
                                    <div class="selected-crypto-details">
                                        <h4 id="selectedCryptoName">Bitcoin</h4>
                                        <p id="selectedCryptoSymbol">BTC</p>
                                    </div>
                                </div>
                                <div class="selected-crypto-price" id="selectedCryptoPrice">$0.00</div>
                            </div>
                            
                            <div class="trade-form" id="tradeForm">
                                <div class="form-group">
                                    <label for="cryptoAmount">Количество</label>
                                    <input type="number" id="cryptoAmount" class="form-control" placeholder="0.00" min="0.000001" step="0.000001" value="0.001" disabled>
                                    
                                    <div class="amount-controls">
                                        <button type="button" class="amount-btn" data-percent="0.25">25%</button>
                                        <button type="button" class="amount-btn" data-percent="0.5">50%</button>
                                        <button type="button" class="amount-btn" data-percent="0.75">75%</button>
                                        <button type="button" class="amount-btn" data-percent="1">100%</button>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label for="totalCost">Сумма (USD)</label>
                                    <input type="number" id="totalCost" class="form-control" placeholder="0.00" disabled>
                                </div>
                                
                                <div class="form-row">
                                    <span class="form-label">Доступно:</span>
                                    <span class="form-value" id="availableBalance">$0.00</span>
                                </div>
                                
                                <div class="form-row">
                                    <span class="form-label">Комиссия (0.1%):</span>
                                    <span class="form-value" id="tradeFee">$0.00</span>
                                </div>
                                
                                <div class="form-row">
                                    <span class="form-label">Итого:</span>
                                    <span class="form-value" id="tradeTotal">$0.00</span>
                                </div>
                                
                                <button type="button" class="btn btn-primary" id="executeTradeBtn" disabled style="width: 100%; padding: 15px; margin-top: 10px;">
                                    <i class="fas fa-check"></i> Подтвердить покупку
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Портфель пользователя -->
                    <div class="portfolio-section">
                        <div class="portfolio-header">
                            <h3 class="portfolio-title">
                                <i class="fas fa-wallet"></i> Мой портфель
                            </h3>
                            <div class="market-controls">
                                <button class="refresh-btn" id="refreshPortfolioBtn">
                                    <i class="fas fa-sync-alt"></i> Обновить
                                </button>
                            </div>
                        </div>
                        
                        <div class="portfolio-stats">
                            <div class="portfolio-stat">
                                <div class="portfolio-stat-value total" id="portfolioTotalValue">$0.00</div>
                                <div class="portfolio-stat-label">Общая стоимость</div>
                            </div>
                            <div class="portfolio-stat">
                                <div class="portfolio-stat-value" id="portfolioInvested">$0.00</div>
                                <div class="portfolio-stat-label">Инвестировано</div>
                            </div>
                            <div class="portfolio-stat">
                                <div class="portfolio-stat-value change" id="portfolioChange">+0.00%</div>
                                <div class="portfolio-stat-label">Изменение</div>
                            </div>
                            <div class="portfolio-stat">
                                <div class="portfolio-stat-value" id="portfolioBalance">$0.00</div>
                                <div class="portfolio-stat-label">Баланс (USD)</div>
                            </div>
                        </div>
                        
                        <div class="portfolio-assets">
                            <table class="portfolio-table">
                                <thead>
                                    <tr>
                                        <th>Актив</th>
                                        <th>Количество</th>
                                        <th>Средняя цена</th>
                                        <th>Текущая цена</th>
                                        <th>Стоимость</th>
                                        <th>Изменение</th>
                                        <th>Действия</th>
                                    </tr>
                                </thead>
                                <tbody id="portfolioTableBody">
                                    <!-- Активы портфеля будут загружены динамически -->
                                </tbody>
                            </table>
                            
                            <div class="portfolio-empty" id="portfolioEmpty" style="display: none;">
                                <i class="fas fa-wallet"></i>
                                <h4>Портфель пуст</h4>
                                <p>Купите первую криптовалюту, чтобы начать инвестировать</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>
    
    <!-- Login Modal -->
    <div class="modal" id="loginModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Вход в аккаунт</h3>
                <button class="close-modal" id="closeLoginModal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="loginForm">
                    <div class="form-group">
                        <label for="loginEmail">Электронная почта</label>
                        <input type="email" id="loginEmail" class="form-control" placeholder="example@mail.com" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="loginPassword">Пароль</label>
                        <input type="password" id="loginPassword" class="form-control" placeholder="Введите ваш пароль" required>
                    </div>
                    
                    <div class="form-footer">
                        <div class="remember-me">
                            <input type="checkbox" id="rememberMe">
                            <label for="rememberMe">Запомнить меня</label>
                        </div>
                        <a href="#" class="forgot-password">Забыли пароль?</a>
                    </div>
                    
                    <button type="submit" class="btn btn-primary" style="width: 100%; padding: 15px; margin-top: 10px;">
                        <i class="fas fa-sign-in-alt"></i> Войти
                    </button>
                    
                    <div class="form-links">
                        <p>Нет аккаунта? <a href="#" id="goToRegister">Зарегистрироваться</a></p>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <!-- Registration Modal -->
    <div class="modal" id="registrationModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Создать аккаунт</h3>
                <button class="close-modal" id="closeRegistrationModal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="registrationForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="firstName">Имя</label>
                            <input type="text" id="firstName" class="form-control" placeholder="Введите ваше имя" required>
                        </div>
                        <div class="form-group">
                            <label for="lastName">Фамилия</label>
                            <input type="text" id="lastName" class="form-control" placeholder="Введите вашу фамилию" required>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="email">Электронная почта</label>
                        <input type="email" id="email" class="form-control" placeholder="example@mail.com" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="phone">Телефон</label>
                        <input type="tel" id="phone" class="form-control" placeholder="+7 (XXX) XXX-XX-XX" required>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="password">Пароль</label>
                            <input type="password" id="password" class="form-control" placeholder="Создайте пароль" required>
                            <div class="password-strength" id="passwordStrength">Сложность: нет</div>
                            <div class="password-requirements">
                                Пароль должен содержать минимум 8 символов, включая цифры и буквы
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="confirmPassword">Подтверждение пароля</label>
                            <input type="password" id="confirmPassword" class="form-control" placeholder="Повторите пароль" required>
                        </div>
                    </div>
                    
                    <div class="checkbox-group">
                        <input type="checkbox" id="terms" required>
                        <label for="terms">Я согласен с условиями использования и политикой конфиденциальности</label>
                    </div>
                    
                    <button type="submit" class="btn btn-primary" style="width: 100%; padding: 15px;">
                        <i class="fas fa-user-plus"></i> Зарегистрироваться
                    </button>
                    
                    <div class="form-links">
                        <p>Уже есть аккаунт? <a href="#" id="goToLogin">Войти</a></p>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <!-- Add Card Modal с превью карты -->
    <div class="modal" id="addCardModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Добавить карту</h3>
                <button class="close-modal" id="closeAddCardModal">&times;</button>
            </div>
            <div class="modal-body">
                <!-- Превью карты -->
                <div class="card-preview" id="cardPreview">
                    <div class="card-preview-header">
                        <div class="card-preview-type" id="previewCardType">VISA</div>
                        <div class="card-preview-chip">
                            <i class="fas fa-microchip"></i>
                        </div>
                    </div>
                    <div class="card-preview-number" id="previewCardNumber">**** **** **** ****</div>
                    <div class="card-preview-footer">
                        <div class="card-preview-expiry" id="previewCardExpiry">MM/YY</div>
                        <div class="card-type-badge" id="previewCardBadge">VISA</div>
                    </div>
                </div>
                
                <form id="addCardForm">
                    <div class="form-group">
                        <label for="cardNumber">Номер карты</label>
                        <input type="text" id="cardNumber" class="form-control" placeholder="1234 5678 9012 3456" required maxlength="19">
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="cardExpiry">Срок действия (MM/YY)</label>
                            <input type="text" id="cardExpiry" class="form-control" placeholder="12/25" required maxlength="5">
                        </div>
                        <div class="form-group">
                            <label for="cardCvc">CVC код</label>
                            <input type="password" id="cardCvc" class="form-control" placeholder="123" required maxlength="3">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="cardBalance">Начальный баланс ($)</label>
                        <input type="number" id="cardBalance" class="form-control" placeholder="1000.00" min="0" step="0.01" value="0.00">
                    </div>
                    
                    <button type="submit" class="btn btn-primary" style="width: 100%; padding: 15px;">
                        <i class="fas fa-credit-card"></i> Добавить карту
                    </button>
                </form>
            </div>
        </div>
    </div>
    
    <!-- Trade Confirm Modal -->
    <div class="modal trade-modal" id="tradeConfirmModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="tradeConfirmTitle">Подтверждение покупки</h3>
                <button class="close-modal" id="closeTradeConfirmModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="trade-summary" id="tradeSummary">
                    <!-- Информация о сделке будет загружена динамически -->
                </div>
                
                <div class="form-group">
                    <label for="tradePassword">Пароль для подтверждения</label>
                    <input type="password" id="tradePassword" class="form-control" placeholder="Введите пароль для подтверждения" required>
                </div>
                
                <div class="form-links">
                    <p id="tradeWarning" style="color: var(--warning); font-size: 0.9rem;">
                        <i class="fas fa-exclamation-triangle"></i> Криптовалюты — это высокорисковые активы. Стоимость может изменяться.
                    </p>
                </div>
                
                <button type="button" class="btn btn-primary" id="confirmTradeBtn" style="width: 100%; padding: 15px;">
                    <i class="fas fa-check"></i> Подтвердить сделку
                </button>
            </div>
        </div>
    </div>
    
    <!-- Deposit Investment Modal -->
    <div class="modal" id="depositInvestmentModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Пополнение инвестиционного счета</h3>
                <button class="close-modal" id="closeDepositInvestmentModal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="depositInvestmentForm">
                    <div class="form-group">
                        <label for="depositAmount">Сумма пополнения ($)</label>
                        <input type="number" id="depositAmount" class="form-control" placeholder="100.00" min="10" step="0.01" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="depositFromCard">С карты</label>
                        <select id="depositFromCard" class="form-control" required>
                            <option value="">Выберите карту</option>
                            <!-- Карты будут добавляться динамически -->
                        </select>
                    </div>
                    
                    <div class="transfer-preview" id="depositPreview">
                        <h4 class="transfer-preview-title">
                            <i class="fas fa-search"></i> Предпросмотр
                        </h4>
                        <div class="transfer-details">
                            <div class="transfer-detail">
                                <span class="transfer-label">Списание с карты:</span>
                                <span class="transfer-value" id="previewDepositFrom">-</span>
                            </div>
                            <div class="transfer-detail">
                                <span class="transfer-label">Зачисление на инвестиции:</span>
                                <span class="transfer-value" id="previewDepositTo">-</span>
                            </div>
                            <div class="transfer-detail">
                                <span class="transfer-label">Комиссия:</span>
                                <span class="transfer-value" id="previewDepositFee">$0.00</span>
                            </div>
                            <div class="transfer-detail">
                                <span class="transfer-label">Итого к списанию:</span>
                                <span class="transfer-value" id="previewDepositTotal">$0.00</span>
                            </div>
                        </div>
                    </div>
                    
                    <button type="submit" class="btn btn-primary" style="width: 100%; padding: 15px; margin-top: 10px;">
                        <i class="fas fa-credit-card"></i> Пополнить счет
                    </button>
                </form>
            </div>
        </div>
    </div>
    
    <!-- Notification -->
    <div class="notification" id="notification">
        <div class="notification-icon">
            <i class="fas fa-check-circle"></i>
        </div>
        <div class="notification-content">
            <div class="notification-title" id="notificationTitle">Успешно!</div>
            <div class="notification-message" id="notificationMessage">Операция выполнена успешно</div>
        </div>
    </div>
    
    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-column">
                    <h3>SecureBank</h3>
                    <p>Футуристичный банкинг нового поколения. Безопасность и технологии будущего уже сегодня. Мы создаем финансовую экосистему, где ваши средства защищены, а управление финансами становится простым и интуитивным.</p>
                    <div class="social-links">
                        <a href="#"><i class="fab fa-facebook-f"></i></a>
                        <a href="#"><i class="fab fa-twitter"></i></a>
                        <a href="#"><i class="fab fa-instagram"></i></a>
                        <a href="#"><i class="fab fa-linkedin-in"></i></a>
                    </div>
                </div>
                
                <div class="footer-column">
                    <h3>Услуги</h3>
                    <ul class="footer-links">
                        <li><a href="#" data-section="cards"><i class="fas fa-credit-card"></i> Банковские карты</a></li>
                        <li><a href="#" data-section="transfers"><i class="fas fa-exchange-alt"></i> Переводы</a></li>
                        <li><a href="#" data-section="investments"><i class="fas fa-chart-line"></i> Инвестиции</a></li>
                        <li><a href="#"><i class="fas fa-shield-alt"></i> Страхование</a></li>
                        <li><a href="#"><i class="fas fa-home"></i> Ипотека</a></li>
                        <li><a href="#"><i class="fas fa-hand-holding-usd"></i> Кредиты</a></li>
                    </ul>
                </div>
                
                <div class="footer-column">
                    <h3>Поддержка</h3>
                    <ul class="footer-links">
                        <li><a href="#"><i class="fas fa-question-circle"></i> Центр помощи</a></li>
                        <li><a href="#"><i class="fas fa-headset"></i> Связаться с нами</a></li>
                        <li><a href="#"><i class="fas fa-bug"></i> Сообщить о проблеме</a></li>
                        <li><a href="#"><i class="fas fa-file-alt"></i> FAQ</a></li>
                        <li><a href="#"><i class="fas fa-lock"></i> Безопасность</a></li>
                        <li><a href="#"><i class="fas fa-download"></i> Скачать приложение</a></li>
                    </ul>
                </div>
                
                <div class="footer-column">
                    <h3>Контакты</h3>
                    <ul class="contact-info">
                        <li>
                            <i class="fas fa-map-marker-alt"></i>
                            <span>Москва, ул. Тверская, 15<br><small>БЦ "Футуро Тауэр"</small></span>
                        </li>
                        <li>
                            <i class="fas fa-phone"></i>
                            <span>+7 (495) 123-45-67<br><small>Пн-Пт: 9:00-18:00</small></span>
                        </li>
                        <li>
                            <i class="fas fa-envelope"></i>
                            <span>info@securebank.ru<br><small>Техподдержка: support@securebank.ru</small></span>
                        </li>
                        <li>
                            <i class="fas fa-clock"></i>
                            <span>24/7 Онлайн-банкинг<br><small>Круглосуточная поддержка</small></span>
                        </li>
                    </ul>
                </div>
            </div>
            
            <div class="footer-bottom">
                <p>&copy; 2023 SecureBank. Все права защищены. Лицензия ЦБ РФ №1234567890 от 01.01.2023</p>
                <p style="margin-top: 8px; font-size: 0.8rem; opacity: 0.7;">Ваши средства застрахованы в соответствии с Федеральным законом №177-ФЗ "О страховании вкладов"</p>
            </div>
        </div>
    </footer>
    
    <script>
        // Состояние приложения
        let currentUser = null;
        let usersData = [];
        let currentCards = [];
        let recipientUser = null;
        let carouselInterval;
        let currentSlide = 0;
        let totalSlides = 3;
        
        // Инвестиционные переменные
        let cryptoData = [];
        let selectedCrypto = null;
        let tradeType = 'buy';
        let cryptoPriceUpdateInterval = null;
        let lastPriceUpdate = null;
        
        // Начальные данные криптовалют (2025 год - прогнозные цены)
        const initialCryptoData = [
            {
                id: 'bitcoin',
                name: 'Bitcoin',
                symbol: 'BTC',
                icon: 'fab fa-bitcoin',
                color: '#f7931a',
                price: 125000.42,
                change24h: 3.21,
                marketCap: 2.45e12,
                volume24h: 45.7e9,
                circulatingSupply: 19650000,
                maxSupply: 21000000
            },
            {
                id: 'ethereum',
                name: 'Ethereum',
                symbol: 'ETH',
                icon: 'fab fa-ethereum',
                color: '#627eea',
                price: 8200.75,
                change24h: 2.45,
                marketCap: 985.3e9,
                volume24h: 28.3e9,
                circulatingSupply: 121000000,
                maxSupply: null
            },
            {
                id: 'cardano',
                name: 'Cardano',
                symbol: 'ADA',
                icon: 'fas fa-chart-bar',
                color: '#0033ad',
                price: 1.85,
                change24h: -0.82,
                marketCap: 65.8e9,
                volume24h: 1.2e9,
                circulatingSupply: 36.2e9,
                maxSupply: 45e9
            },
            {
                id: 'solana',
                name: 'Solana',
                symbol: 'SOL',
                icon: 'fas fa-fire',
                color: '#00ffa3',
                price: 420.50,
                change24h: 7.32,
                marketCap: 188.1e9,
                volume24h: 8.5e9,
                circulatingSupply: 450e6,
                maxSupply: null
            },
            {
                id: 'ripple',
                name: 'Ripple',
                symbol: 'XRP',
                icon: 'fas fa-bolt',
                color: '#23292f',
                price: 2.15,
                change24h: 1.23,
                marketCap: 118.3e9,
                volume24h: 4.2e9,
                circulatingSupply: 55.5e9,
                maxSupply: 100e9
            },
            {
                id: 'polkadot',
                name: 'Polkadot',
                symbol: 'DOT',
                icon: 'fas fa-circle',
                color: '#e6007a',
                price: 25.80,
                change24h: -2.15,
                marketCap: 33.3e9,
                volume24h: 850e6,
                circulatingSupply: 1.29e9,
                maxSupply: null
            },
            {
                id: 'dogecoin',
                name: 'Dogecoin',
                symbol: 'DOGE',
                icon: 'fab fa-reddit',
                color: '#c2a633',
                price: 0.45,
                change24h: 4.82,
                marketCap: 65.1e9,
                volume24h: 2.8e9,
                circulatingSupply: 145e9,
                maxSupply: null
            },
            {
                id: 'chainlink',
                name: 'Chainlink',
                symbol: 'LINK',
                icon: 'fas fa-link',
                color: '#2a5ada',
                price: 42.30,
                change24h: 1.85,
                marketCap: 24.8e9,
                volume24h: 1.5e9,
                circulatingSupply: 587e6,
                maxSupply: 1e9
            }
        ];
        
        // Улучшенная функция определения типа карты по номеру
        function detectCardType(cardNumber) {
            const cleaned = cardNumber.replace(/\D/g, '');
            
            // Visa: начинается с 4
            if (/^4/.test(cleaned)) return 'visa';
            
            // MasterCard: начинается с 51-55 или 2221-2720
            if (/^5[1-5]/.test(cleaned) || /^2[2-7][0-9][0-9]/.test(cleaned)) return 'mastercard';
            
            // Мир: начинается с 2200-2204
            if (/^220[0-4]/.test(cleaned)) return 'mir';
            
            // American Express: начинается с 34 или 37
            if (/^3[47]/.test(cleaned)) return 'amex';
            
            // Discover: начинается с 6011, 65, или 644-649
            if (/^6011/.test(cleaned) || /^65/.test(cleaned) || /^64[4-9]/.test(cleaned)) return 'discover';
            
            // JCB: начинается с 3528-3589
            if (/^35[2-8][0-9]/.test(cleaned)) return 'jcb';
            
            // По умолчанию возвращаем visa
            return 'visa';
        }
        
        // Функция для загрузки данных пользователей
        function loadUsersData() {
            const savedData = localStorage.getItem('bankUsersData');
            if (savedData) {
                usersData = JSON.parse(savedData);
            } else {
                createDemoUsers();
            }
            
            // Загружаем данные криптовалют
            loadCryptoData();
        }
        
        // Функция для создания демо-пользователей
        function createDemoUsers() {
            const generateSampleTransactions = (count = 8) => {
                const transactions = [];
                const categories = [
                    { name: 'Продукты', type: 'expense' },
                    { name: 'Кафе и рестораны', type: 'expense' },
                    { name: 'Транспорт', type: 'expense' },
                    { name: 'Развлечения', type: 'expense' },
                    { name: 'Одежда', type: 'expense' },
                    { name: 'Зарплата', type: 'income' },
                    { name: 'Перевод', type: 'income' },
                    { name: 'Интернет', type: 'expense' },
                    { name: 'Коммунальные услуги', type: 'expense' }
                ];
                
                const daysAgo = [0, 1, 2, 3, 4, 5, 6, 7];
                
                for (let i = 0; i < count; i++) {
                    const category = categories[Math.floor(Math.random() * categories.length)];
                    const isIncome = category.type === 'income';
                    const amount = isIncome 
                        ? (Math.random() * 2000 + 100).toFixed(2)
                        : (Math.random() * 200 + 5).toFixed(2);
                    
                    const day = daysAgo[Math.floor(Math.random() * daysAgo.length)];
                    const date = new Date();
                    date.setDate(date.getDate() - day);
                    
                    const dateStr = date.toLocaleDateString('ru-RU', { day: 'numeric', month: 'long' });
                    
                    transactions.push({
                        id: 'trans_' + Date.now() + i,
                        name: category.name,
                        date: dateStr,
                        amount: isIncome ? parseFloat(amount) : -parseFloat(amount),
                        type: category.type,
                        category: category.name
                    });
                }
                
                return transactions.sort((a, b) => {
                    const dateA = new Date(a.date);
                    const dateB = new Date(b.date);
                    return dateB - dateA;
                });
            };
            
            usersData = [
                {
                    id: '1',
                    firstName: 'Иван',
                    lastName: 'Иванов',
                    email: 'ivan@example.com',
                    phone: '+7 (999) 123-45-67',
                    password: 'Password123',
                    cards: [
                        {
                            id: 'card1',
                            number: '4111111111111111',
                            expiry: '12/25',
                            cvc: '123',
                            balance: '2500.75',
                            type: 'visa',
                            transactions: generateSampleTransactions(6)
                        },
                        {
                            id: 'card2',
                            number: '5555555555554444',
                            expiry: '08/24',
                            cvc: '456',
                            balance: '1200.50',
                            type: 'mastercard',
                            transactions: generateSampleTransactions(4)
                        }
                    ],
                    transfers: [],
                    // Инвестиционные данные
                    investmentBalance: 5000.00,
                    cryptoPortfolio: [
                        {
                            id: 'bitcoin',
                            symbol: 'BTC',
                            amount: 0.025,
                            averagePrice: 105000.00,
                            totalInvested: 2625.00
                        },
                        {
                            id: 'ethereum',
                            symbol: 'ETH',
                            amount: 1.5,
                            averagePrice: 6500.00,
                            totalInvested: 9750.00
                        }
                    ],
                    tradeHistory: [
                        {
                            id: 'trade1',
                            date: '2024-10-15 14:30',
                            type: 'buy',
                            crypto: 'BTC',
                            amount: 0.025,
                            price: 105000.00,
                            total: 2625.00,
                            fee: 2.63
                        },
                        {
                            id: 'trade2',
                            date: '2024-11-20 11:15',
                            type: 'buy',
                            crypto: 'ETH',
                            amount: 1.5,
                            price: 6500.00,
                            total: 9750.00,
                            fee: 9.75
                        }
                    ]
                },
                {
                    id: '2',
                    firstName: 'Алексей',
                    lastName: 'Петров',
                    email: 'alexey@example.com',
                    phone: '+7 (999) 987-65-43',
                    password: 'Password123',
                    cards: [
                        {
                            id: 'card3',
                            number: '2200123456789012',
                            expiry: '05/26',
                            cvc: '789',
                            balance: '3500.00',
                            type: 'mir',
                            transactions: generateSampleTransactions(5)
                        }
                    ],
                    transfers: [],
                    investmentBalance: 3000.00,
                    cryptoPortfolio: [],
                    tradeHistory: []
                },
                {
                    id: '3',
                    firstName: 'Мария',
                    lastName: 'Сидорова',
                    email: 'maria@example.com',
                    phone: '+7 (999) 456-78-90',
                    password: 'Password123',
                    cards: [
                        {
                            id: 'card4',
                            number: '4111222233334444',
                            expiry: '11/23',
                            cvc: '321',
                            balance: '1800.25',
                            type: 'visa',
                            transactions: generateSampleTransactions(5)
                        }
                    ],
                    transfers: [],
                    investmentBalance: 7500.00,
                    cryptoPortfolio: [
                        {
                            id: 'solana',
                            symbol: 'SOL',
                            amount: 5.2,
                            averagePrice: 350.00,
                            totalInvested: 1820.00
                        }
                    ],
                    tradeHistory: []
                }
            ];
            saveUsersData();
        }
        
        // Функция для сохранения данных пользователей
        function saveUsersData() {
            localStorage.setItem('bankUsersData', JSON.stringify(usersData));
        }
        
        // Функция для загрузки данных криптовалют
        function loadCryptoData() {
            const savedCryptoData = localStorage.getItem('bankCryptoData');
            if (savedCryptoData) {
                cryptoData = JSON.parse(savedCryptoData);
                const lastUpdate = localStorage.getItem('bankCryptoLastUpdate');
                if (lastUpdate) {
                    lastPriceUpdate = new Date(lastUpdate);
                    const now = new Date();
                    const diffMinutes = (now - lastPriceUpdate) / (1000 * 60);
                    
                    // Если прошло больше 1 минуты, обновляем цены
                    if (diffMinutes > 1) {
                        updateCryptoPrices();
                    }
                }
            } else {
                cryptoData = JSON.parse(JSON.stringify(initialCryptoData));
                lastPriceUpdate = new Date();
                saveCryptoData();
            }
        }
        
        // Функция для сохранения данных криптовалют
        function saveCryptoData() {
            localStorage.setItem('bankCryptoData', JSON.stringify(cryptoData));
            localStorage.setItem('bankCryptoLastUpdate', lastPriceUpdate.toISOString());
        }
        
        // Функция для обновления цен криптовалют
        function updateCryptoPrices() {
            const now = new Date();
            
            cryptoData.forEach(crypto => {
                // Генерируем случайное изменение цены в пределах ±3%
                const changePercent = (Math.random() * 6 - 3) / 100;
                crypto.price = crypto.price * (1 + changePercent);
                
                // Обновляем изменение за 24ч (в пределах ±8%)
                crypto.change24h = (Math.random() * 16 - 8);
                
                // Обновляем объем торгов
                const volumeChange = (Math.random() * 30 - 15) / 100;
                crypto.volume24h = crypto.volume24h * (1 + volumeChange);
                
                // Обновляем рыночную капитализацию
                crypto.marketCap = crypto.price * crypto.circulatingSupply;
            });
            
            lastPriceUpdate = now;
            saveCryptoData();
            
            // Обновляем отображение
            if (document.getElementById('investmentsSection').classList.contains('active')) {
                renderCryptoTable();
                updatePortfolio();
            }
            
            // Обновляем время последнего обновления
            updateLastUpdateTime();
            
            return cryptoData;
        }
        
        // Функция для обновления времени последнего обновления
        function updateLastUpdateTime() {
            const lastUpdateElement = document.getElementById('lastUpdateTime');
            if (lastUpdateElement && lastPriceUpdate) {
                const now = new Date();
                const diffSeconds = Math.floor((now - lastPriceUpdate) / 1000);
                
                if (diffSeconds < 60) {
                    lastUpdateElement.textContent = `Последнее обновление: только что`;
                } else if (diffSeconds < 3600) {
                    const minutes = Math.floor(diffSeconds / 60);
                    lastUpdateElement.textContent = `Последнее обновление: ${minutes} ${minutes === 1 ? 'минуту' : minutes < 5 ? 'минуты' : 'минут'} назад`;
                } else {
                    const hours = Math.floor(diffSeconds / 3600);
                    lastUpdateElement.textContent = `Последнее обновление: ${hours} ${hours === 1 ? 'час' : hours < 5 ? 'часа' : 'часов'} назад`;
                }
            }
        }
        
        // Функция для проверки сложности пароля
        function checkPasswordStrength(password) {
            if (!password) return { strength: 0, text: 'нет', className: 'weak' };
            
            let strength = 0;
            
            // Проверка длины
            if (password.length >= 8) strength += 1;
            
            // Проверка на наличие цифр
            if (/\d/.test(password)) strength += 1;
            
            // Проверка на наличие букв в нижнем регистре
            if (/[a-z]/.test(password)) strength += 1;
            
            // Проверка на наличие букв в верхнем регистре
            if (/[A-Z]/.test(password)) strength += 1;
            
            // Проверка на наличие специальных символов
            if (/[^a-zA-Z0-9]/.test(password)) strength += 1;
            
            if (strength <= 2) {
                return { strength, text: 'слабый', className: 'weak' };
            } else if (strength <= 4) {
                return { strength, text: 'средний', className: 'medium' };
            } else {
                return { strength, text: 'сильный', className: 'strong' };
            }
        }
        
        // Функция для отображения таблицы криптовалют
        function renderCryptoTable() {
            const tableBody = document.getElementById('cryptoTableBody');
            if (!tableBody) return;
            
            tableBody.innerHTML = '';
            
            cryptoData.forEach(crypto => {
                const row = document.createElement('tr');
                row.dataset.cryptoId = crypto.id;
                
                // Форматируем цену
                const formattedPrice = formatCurrency(crypto.price, 2);
                
                // Определяем класс для изменения цены
                const changeClass = crypto.change24h > 0 ? 'positive' : crypto.change24h < 0 ? 'negative' : 'neutral';
                const changeSymbol = crypto.change24h > 0 ? '+' : '';
                const formattedChange = `${changeSymbol}${crypto.change24h.toFixed(2)}%`;
                
                row.innerHTML = `
                    <td>
                        <div class="crypto-info">
                            <div class="crypto-icon" style="background-color: ${crypto.color}20; color: ${crypto.color};">
                                <i class="${crypto.icon}"></i>
                            </div>
                            <div>
                                <div class="crypto-name">${crypto.name}</div>
                                <div class="crypto-symbol">${crypto.symbol}</div>
                            </div>
                        </div>
                    </td>
                    <td>
                        <div class="crypto-price">${formattedPrice}</div>
                    </td>
                    <td>
                        <div class="crypto-change ${changeClass}">${formattedChange}</div>
                    </td>
                    <td>
                        <div class="crypto-actions">
                            <button class="trade-btn buy" data-crypto-id="${crypto.id}" data-action="buy">
                                <i class="fas fa-arrow-up"></i> Купить
                            </button>
                            <button class="trade-btn sell" data-crypto-id="${crypto.id}" data-action="sell">
                                <i class="fas fa-arrow-down"></i> Продать
                            </button>
                        </div>
                    </td>
                `;
                
                tableBody.appendChild(row);
            });
            
            // Добавляем обработчики событий для кнопок купли/продажи
            document.querySelectorAll('.trade-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const cryptoId = this.getAttribute('data-crypto-id');
                    const action = this.getAttribute('data-action');
                    selectCryptoForTrade(cryptoId, action);
                });
            });
        }
        
        // Функция для выбора криптовалюты для торговли
        function selectCryptoForTrade(cryptoId, action = 'buy') {
            const crypto = cryptoData.find(c => c.id === cryptoId);
            if (!crypto) return;
            
            selectedCrypto = crypto;
            tradeType = action;
            
            // Обновляем интерфейс торговой панели
            updateTradePanel();
            
            // Показываем информацию о выбранной криптовалюте
            document.getElementById('selectedCryptoInfo').style.display = 'flex';
            
            // Обновляем кнопки типа торговли
            document.querySelectorAll('.trade-type-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.getAttribute('data-type') === tradeType) {
                    btn.classList.add('active');
                }
            });
        }
        
        // Функция для обновления торговой панели
        function updateTradePanel() {
            if (!selectedCrypto || !currentUser) return;
            
            const crypto = selectedCrypto;
            const user = usersData.find(u => u.email === currentUser.email);
            if (!user) return;
            
            // Обновляем информацию о выбранной криптовалюте
            document.getElementById('selectedCryptoName').textContent = crypto.name;
            document.getElementById('selectedCryptoSymbol').textContent = crypto.symbol;
            document.getElementById('selectedCryptoPrice').textContent = formatCurrency(crypto.price, 2);
            
            // Обновляем иконку
            const iconElement = document.getElementById('selectedCryptoIcon');
            iconElement.innerHTML = `<i class="${crypto.icon}"></i>`;
            iconElement.style.backgroundColor = `${crypto.color}20`;
            iconElement.style.color = crypto.color;
            
            // Обновляем доступный баланс
            let availableBalance = user.investmentBalance || 0;
            
            // Если это продажа, показываем доступное количество этой криптовалюты
            if (tradeType === 'sell') {
                const portfolioItem = user.cryptoPortfolio?.find(item => item.id === crypto.id);
                availableBalance = portfolioItem ? portfolioItem.amount : 0;
                
                document.getElementById('availableBalance').textContent = `${availableBalance.toFixed(6)} ${crypto.symbol}`;
            } else {
                document.getElementById('availableBalance').textContent = formatCurrency(availableBalance, 2);
            }
            
            // Обновляем текст кнопки
            const executeBtn = document.getElementById('executeTradeBtn');
            executeBtn.innerHTML = `<i class="fas fa-check"></i> Подтвердить ${tradeType === 'buy' ? 'покупку' : 'продажу'}`;
            
            // Включаем поле ввода
            document.getElementById('cryptoAmount').disabled = false;
            
            // Сбрасываем значения
            document.getElementById('cryptoAmount').value = '0.001';
            updateTradeCalculations();
        }
        
        // Функция для обновления расчетов торговли
        function updateTradeCalculations() {
            if (!selectedCrypto) return;
            
            const amount = parseFloat(document.getElementById('cryptoAmount').value) || 0;
            const price = selectedCrypto.price;
            const total = amount * price;
            const fee = total * 0.001; // Комиссия 0.1%
            const totalWithFee = tradeType === 'buy' ? total + fee : total - fee;
            
            // Обновляем поля
            document.getElementById('totalCost').value = total.toFixed(2);
            document.getElementById('tradeFee').textContent = formatCurrency(fee, 2);
            document.getElementById('tradeTotal').textContent = formatCurrency(totalWithFee, 2);
            
            // Проверяем, достаточно ли средств
            const user = usersData.find(u => u.email === currentUser.email);
            if (!user) return;
            
            const executeBtn = document.getElementById('executeTradeBtn');
            
            if (tradeType === 'buy') {
                const availableBalance = user.investmentBalance || 0;
                if (amount > 0 && totalWithFee <= availableBalance) {
                    executeBtn.disabled = false;
                    executeBtn.style.backgroundColor = 'var(--success)';
                } else {
                    executeBtn.disabled = true;
                    executeBtn.style.backgroundColor = 'var(--border-color)';
                }
            } else {
                const portfolioItem = user.cryptoPortfolio?.find(item => item.id === selectedCrypto.id);
                const availableAmount = portfolioItem ? portfolioItem.amount : 0;
                
                if (amount > 0 && amount <= availableAmount) {
                    executeBtn.disabled = false;
                    executeBtn.style.backgroundColor = 'var(--danger)';
                } else {
                    executeBtn.disabled = true;
                    executeBtn.style.backgroundColor = 'var(--border-color)';
                }
            }
        }
        
        // Функция для обновления портфеля пользователя
        function updatePortfolio() {
            if (!currentUser) return;
            
            const user = usersData.find(u => u.email === currentUser.email);
            if (!user) return;
            
            const portfolioTableBody = document.getElementById('portfolioTableBody');
            const portfolioEmpty = document.getElementById('portfolioEmpty');
            
            // Проверяем, есть ли активы в портфеле
            const hasAssets = user.cryptoPortfolio && user.cryptoPortfolio.length > 0;
            
            if (hasAssets) {
                portfolioTableBody.innerHTML = '';
                portfolioEmpty.style.display = 'none';
                
                let totalPortfolioValue = 0;
                let totalInvested = 0;
                
                user.cryptoPortfolio.forEach(item => {
                    const crypto = cryptoData.find(c => c.id === item.id);
                    if (!crypto) return;
                    
                    const currentValue = item.amount * crypto.price;
                    const change = ((currentValue - item.totalInvested) / item.totalInvested) * 100;
                    const changeClass = change >= 0 ? 'positive' : 'negative';
                    const changeSymbol = change >= 0 ? '+' : '';
                    
                    totalPortfolioValue += currentValue;
                    totalInvested += item.totalInvested;
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>
                            <div class="crypto-info">
                                <div class="crypto-icon" style="background-color: ${crypto.color}20; color: ${crypto.color};">
                                    <i class="${crypto.icon}"></i>
                                </div>
                                <div>
                                    <div class="crypto-name">${crypto.name}</div>
                                    <div class="crypto-symbol">${crypto.symbol}</div>
                                </div>
                            </div>
                        </td>
                        <td>${item.amount.toFixed(6)}</td>
                        <td>${formatCurrency(item.averagePrice, 2)}</td>
                        <td>${formatCurrency(crypto.price, 2)}</td>
                        <td>${formatCurrency(currentValue, 2)}</td>
                        <td>
                            <div class="crypto-change ${changeClass}">${changeSymbol}${change.toFixed(2)}%</div>
                        </td>
                        <td>
                            <div class="portfolio-actions">
                                <button class="trade-btn buy" data-crypto-id="${crypto.id}" data-action="buy">
                                    <i class="fas fa-arrow-up"></i>
                                </button>
                                <button class="trade-btn sell" data-crypto-id="${crypto.id}" data-action="sell">
                                    <i class="fas fa-arrow-down"></i>
                                </button>
                            </div>
                        </td>
                    `;
                    portfolioTableBody.appendChild(row);
                });
                
                // Обновляем статистику портфеля
                const totalChange = ((totalPortfolioValue - totalInvested) / totalInvested) * 100;
                const totalChangeClass = totalChange >= 0 ? 'positive' : 'negative';
                const totalChangeSymbol = totalChange >= 0 ? '+' : '';
                
                document.getElementById('portfolioTotalValue').textContent = formatCurrency(totalPortfolioValue, 2);
                document.getElementById('portfolioInvested').textContent = formatCurrency(totalInvested, 2);
                document.getElementById('portfolioChange').textContent = `${totalChangeSymbol}${totalChange.toFixed(2)}%`;
                document.getElementById('portfolioChange').className = `portfolio-stat-value change ${totalChangeClass}`;
                document.getElementById('portfolioBalance').textContent = formatCurrency(user.investmentBalance || 0, 2);
            } else {
                portfolioTableBody.innerHTML = '';
                portfolioEmpty.style.display = 'block';
                
                // Обнуляем статистику портфеля
                document.getElementById('portfolioTotalValue').textContent = '$0.00';
                document.getElementById('portfolioInvested').textContent = '$0.00';
                document.getElementById('portfolioChange').textContent = '+0.00%';
                document.getElementById('portfolioChange').className = 'portfolio-stat-value change positive';
                document.getElementById('portfolioBalance').textContent = formatCurrency(user.investmentBalance || 0, 2);
            }
            
            // Добавляем обработчики событий для кнопок в портфеле
            document.querySelectorAll('.portfolio-actions .trade-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const cryptoId = this.getAttribute('data-crypto-id');
                    const action = this.getAttribute('data-action');
                    selectCryptoForTrade(cryptoId, action);
                    
                    // Прокручиваем к панели торговли
                    document.querySelector('.trade-panel').scrollIntoView({ behavior: 'smooth' });
                });
            });
        }
        
        // Функция для выполнения сделки
        function executeTrade() {
            if (!selectedCrypto || !currentUser) return false;
            
            const userIndex = usersData.findIndex(u => u.email === currentUser.email);
            if (userIndex === -1) return false;
            
            const user = usersData[userIndex];
            const amount = parseFloat(document.getElementById('cryptoAmount').value);
            const price = selectedCrypto.price;
            const total = amount * price;
            const fee = total * 0.001;
            
            if (tradeType === 'buy') {
                // Проверяем, достаточно ли средств
                if (user.investmentBalance < total + fee) {
                    showNotification('Ошибка', 'Недостаточно средств на инвестиционном счете', 'error');
                    return false;
                }
                
                // Списание средств
                user.investmentBalance -= (total + fee);
                
                // Добавление в портфель
                let portfolioItem = user.cryptoPortfolio?.find(item => item.id === selectedCrypto.id);
                
                if (portfolioItem) {
                    // Пересчитываем среднюю цену
                    const newTotalAmount = portfolioItem.amount + amount;
                    const newTotalInvested = portfolioItem.totalInvested + total;
                    portfolioItem.averagePrice = newTotalInvested / newTotalAmount;
                    portfolioItem.amount = newTotalAmount;
                    portfolioItem.totalInvested = newTotalInvested;
                } else {
                    // Создаем новый элемент портфеля
                    if (!user.cryptoPortfolio) user.cryptoPortfolio = [];
                    user.cryptoPortfolio.push({
                        id: selectedCrypto.id,
                        symbol: selectedCrypto.symbol,
                        amount: amount,
                        averagePrice: price,
                        totalInvested: total
                    });
                }
            } else {
                // Продажа
                const portfolioItem = user.cryptoPortfolio?.find(item => item.id === selectedCrypto.id);
                
                if (!portfolioItem || portfolioItem.amount < amount) {
                    showNotification('Ошибка', 'Недостаточно криптовалюты для продажи', 'error');
                    return false;
                }
                
                // Зачисление средств (минус комиссия)
                user.investmentBalance += (total - fee);
                
                // Обновление портфеля
                if (portfolioItem.amount === amount) {
                    // Если продаем всё, удаляем из портфеля
                    user.cryptoPortfolio = user.cryptoPortfolio.filter(item => item.id !== selectedCrypto.id);
                } else {
                    // Если продаем часть, уменьшаем количество
                    portfolioItem.amount -= amount;
                    // Пересчитываем общую инвестированную сумму
                    portfolioItem.totalInvested = portfolioItem.amount * portfolioItem.averagePrice;
                }
            }
            
            // Добавление в историю сделок
            if (!user.tradeHistory)            // Добавление в историю сделок
            if (!user.tradeHistory) user.tradeHistory = [];
            user.tradeHistory.push({
                id: 'trade_' + Date.now(),
                date: new Date().toLocaleString('ru-RU'),
                type: tradeType,
                crypto: selectedCrypto.symbol,
                amount: amount,
                price: price,
                total: total,
                fee: fee
            });
            
            // Обновление данных пользователя
            usersData[userIndex] = user;
            saveUsersData();
            
            // Обновление текущего пользователя
            if (currentUser.email === user.email) {
                currentUser = { ...currentUser, ...user };
            }
            
            // Обновление интерфейса
            updatePortfolio();
            updateTradePanel();
            
            // Показываем уведомление
            const actionText = tradeType === 'buy' ? 'покупка' : 'продажа';
            showNotification('Сделка выполнена', 
                `${actionText} ${amount} ${selectedCrypto.symbol} на сумму ${formatCurrency(total, 2)}`, 
                'success');
            
            // Закрываем модальное окно подтверждения
            closeModal('tradeConfirmModal');
            
            // Сбрасываем выбранную криптовалюту
            selectedCrypto = null;
            document.getElementById('selectedCryptoInfo').style.display = 'none';
            document.getElementById('cryptoAmount').value = '0.001';
            document.getElementById('cryptoAmount').disabled = true;
            
            return true;
        }
        
        // Функция для отображения уведомлений
        function showNotification(title, message, type = 'success') {
            const notification = document.getElementById('notification');
            const notificationTitle = document.getElementById('notificationTitle');
            const notificationMessage = document.getElementById('notificationMessage');
            const notificationIcon = notification.querySelector('.notification-icon i');
            
            // Устанавливаем заголовок и сообщение
            notificationTitle.textContent = title;
            notificationMessage.textContent = message;
            
            // Устанавливаем тип уведомления
            notification.className = 'notification';
            notification.classList.add(type);
            
            // Устанавливаем иконку в зависимости от типа
            notificationIcon.className = type === 'success' ? 'fas fa-check-circle' :
                                        type === 'error' ? 'fas fa-exclamation-circle' :
                                        'fas fa-exclamation-triangle';
            
            // Показываем уведомление
            notification.classList.add('active');
            
            // Автоматически скрываем через 5 секунд
            setTimeout(() => {
                notification.classList.remove('active');
            }, 5000);
            
            // Добавляем возможность закрытия по клику
            notification.addEventListener('click', () => {
                notification.classList.remove('active');
            });
        }
        
        // Функция для форматирования валюты
        function formatCurrency(amount, decimals = 2) {
            return '$' + parseFloat(amount).toFixed(decimals).replace(/\d(?=(\d{3})+\.)/g, '$&,');
        }
        
        // Функция для форматирования номера карты
        function formatCardNumber(cardNumber) {
            const cleaned = cardNumber.replace(/\D/g, '');
            const parts = cleaned.match(/.{1,4}/g);
            return parts ? parts.join(' ') : cardNumber;
        }
        
        // Функция для обновления интерфейса при изменении пользователя
        function updateUIForUser() {
            const userInfo = document.getElementById('userInfo');
            const authButtons = document.getElementById('authButtons');
            const heroAuthButtons = document.getElementById('heroAuthButtons');
            
            if (currentUser) {
                // Показываем информацию о пользователе
                userInfo.style.display = 'flex';
                authButtons.querySelector('.user-avatar').textContent = 
                    currentUser.firstName[0] + currentUser.lastName[0];
                authButtons.querySelector('.user-name').textContent = 
                    `${currentUser.firstName} ${currentUser.lastName}`;
                
                // Скрываем кнопки входа/регистрации
                authButtons.querySelector('#loginBtn').style.display = 'none';
                authButtons.querySelector('#registerBtn').style.display = 'none';
                
                // Обновляем кнопки в hero секции
                if (heroAuthButtons) {
                    heroAuthButtons.innerHTML = `
                        <button class="btn btn-primary pulse" id="heroDashboardBtn">
                            <i class="fas fa-tachometer-alt"></i> Перейти в кабинет
                        </button>
                        <button class="btn btn-secondary" id="downloadAppBtn">
                            <i class="fas fa-mobile-alt"></i> Скачать приложение
                        </button>
                    `;
                    
                    // Добавляем обработчик для кнопки перехода в кабинет
                    document.getElementById('heroDashboardBtn')?.addEventListener('click', () => {
                        switchSection('cards');
                    });
                }
                
                // Загружаем карты пользователя
                loadUserCards();
                loadUserTransfers();
                updatePortfolio();
                
                // Обновляем селекты карт в формах
                updateCardSelects();
                
                // Запускаем автоматическое обновление цен криптовалют
                startCryptoPriceUpdates();
            } else {
                // Скрываем информацию о пользователе
                userInfo.style.display = 'none';
                
                // Показываем кнопки входа/регистрации
                authButtons.querySelector('#loginBtn').style.display = 'flex';
                authButtons.querySelector('#registerBtn').style.display = 'flex';
                
                // Обновляем кнопки в hero секции
                if (heroAuthButtons) {
                    heroAuthButtons.innerHTML = `
                        <button class="btn btn-primary pulse" id="heroRegisterBtn">
                            <i class="fas fa-rocket"></i> Начать путешествие
                        </button>
                        <button class="btn btn-secondary">
                            <i class="fas fa-mobile-alt"></i> Скачать приложение
                        </button>
                    `;
                }
                
                // Останавливаем обновление цен криптовалют
                stopCryptoPriceUpdates();
            }
        }
        
        // Функция для загрузки карт пользователя
        function loadUserCards() {
            if (!currentUser) {
                document.getElementById('cardsGrid').innerHTML = '';
                return;
            }
            
            const user = usersData.find(u => u.email === currentUser.email);
            if (!user || !user.cards || user.cards.length === 0) {
                showEmptyCardsState();
                return;
            }
            
            currentCards = user.cards;
            const cardsGrid = document.getElementById('cardsGrid');
            cardsGrid.innerHTML = '';
            
            // Добавляем карты
            user.cards.forEach(card => {
                const cardElement = createCardElement(card);
                cardsGrid.appendChild(cardElement);
            });
            
            // Добавляем виджет для добавления новой карты
            const addCardWidget = document.createElement('div');
            addCardWidget.className = 'card-widget add-card-widget';
            addCardWidget.id = 'addCardWidget';
            addCardWidget.innerHTML = `
                <div class="add-card-icon">
                    <i class="fas fa-plus-circle"></i>
                </div>
                <div class="add-card-text">
                    Добавить карту
                </div>
            `;
            addCardWidget.addEventListener('click', () => openModal('addCardModal'));
            cardsGrid.appendChild(addCardWidget);
            
            // Загружаем транзакции для карусели
            loadTransactionsForCarousel();
        }
        
        // Функция для создания элемента карты
        function createCardElement(card) {
            const cardElement = document.createElement('div');
            cardElement.className = `card-widget ${card.type}`;
            cardElement.dataset.cardId = card.id;
            
            const formattedNumber = formatCardNumber(card.number);
            const lastFour = formattedNumber.slice(-4);
            const displayNumber = '**** **** **** ' + lastFour;
            
            // Определяем иконку для типа карты
            const cardIcon = card.type === 'visa' ? 'fab fa-cc-visa' :
                            card.type === 'mastercard' ? 'fab fa-cc-mastercard' :
                            card.type === 'mir' ? 'fas fa-credit-card' : 'fas fa-credit-card';
            
            cardElement.innerHTML = `
                <div class="card-actions">
                    <button class="card-action-btn" title="Пополнить" data-action="deposit">
                        <i class="fas fa-arrow-down"></i>
                    </button>
                    <button class="card-action-btn" title="Заблокировать" data-action="block">
                        <i class="fas fa-ban"></i>
                    </button>
                    <button class="card-action-btn" title="Удалить" data-action="delete">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
                <div class="card-header">
                    <div class="card-type">
                        <i class="${cardIcon}"></i> ${card.type.toUpperCase()}
                    </div>
                    <div class="card-chip">
                        <i class="fas fa-microchip"></i>
                    </div>
                </div>
                <div class="card-number">${displayNumber}</div>
                <div class="card-footer">
                    <div class="card-info">
                        <div class="card-label">Срок действия</div>
                        <div class="card-expiry">${card.expiry}</div>
                        <div class="card-label">Баланс</div>
                    </div>
                    <div class="card-balance">${formatCurrency(card.balance)}</div>
                </div>
            `;
            
            // Добавляем обработчики для кнопок действий
            cardElement.querySelectorAll('.card-action-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const action = this.getAttribute('data-action');
                    handleCardAction(card.id, action);
                });
            });
            
            return cardElement;
        }
        
        // Функция для обработки действий с картой
        function handleCardAction(cardId, action) {
            const card = currentCards.find(c => c.id === cardId);
            if (!card) return;
            
            switch(action) {
                case 'deposit':
                    showNotification('Информация', 'Функция пополнения временно недоступна', 'warning');
                    break;
                    
                case 'block':
                    if (confirm(`Вы уверены, что хотите заблокировать карту **** ${card.number.slice(-4)}?`)) {
                        showNotification('Успешно', 'Карта успешно заблокирована', 'success');
                    }
                    break;
                    
                case 'delete':
                    if (confirm(`Вы уверены, что хотите удалить карту **** ${card.number.slice(-4)}?`)) {
                        deleteCard(cardId);
                    }
                    break;
            }
        }
        
        // Функция для удаления карты
        function deleteCard(cardId) {
            const userIndex = usersData.findIndex(u => u.email === currentUser.email);
            if (userIndex === -1) return;
            
            const user = usersData[userIndex];
            user.cards = user.cards.filter(card => card.id !== cardId);
            
            // Обновляем данные
            usersData[userIndex] = user;
            saveUsersData();
            
            // Обновляем интерфейс
            loadUserCards();
            updateCardSelects();
            
            showNotification('Успешно', 'Карта успешно удалена', 'success');
        }
        
        // Функция для отображения пустого состояния карт
        function showEmptyCardsState() {
            const cardsGrid = document.getElementById('cardsGrid');
            cardsGrid.innerHTML = `
                <div class="card-widget add-card-widget" style="grid-column: 1 / -1; min-height: 300px;">
                    <div class="add-card-icon">
                        <i class="fas fa-credit-card"></i>
                    </div>
                    <div class="add-card-text" style="font-size: 1.8rem;">
                        У вас пока нет карт
                    </div>
                    <p style="color: var(--text-secondary); margin-top: 10px;">
                        Добавьте свою первую карту, чтобы начать пользоваться банкингом
                    </p>
                    <button class="btn btn-primary" style="margin-top: 20px;" id="addFirstCardBtn">
                        <i class="fas fa-plus"></i> Добавить первую карту
                    </button>
                </div>
            `;
            
            document.getElementById('addFirstCardBtn')?.addEventListener('click', () => {
                openModal('addCardModal');
            });
        }
        
        // Функция для загрузки транзакций в карусель
        function loadTransactionsForCarousel() {
            if (!currentUser) return;
            
            const user = usersData.find(u => u.email === currentUser.email);
            if (!user) return;
            
            // Собираем все транзакции со всех карт
            let allTransactions = [];
            user.cards?.forEach(card => {
                if (card.transactions) {
                    card.transactions.forEach(trans => {
                        allTransactions.push({
                            ...trans,
                            cardLastFour: card.number.slice(-4)
                        });
                    });
                }
            });
            
            // Сортируем по дате (новые сначала)
            allTransactions.sort((a, b) => {
                // Простая сортировка по ID (в нашем случае в ID есть время)
                return b.id.localeCompare(a.id);
            });
            
            // Ограничиваем 5 последними транзакциями
            const recentTransactions = allTransactions.slice(0, 5);
            
            // Обновляем список последних транзакций
            const recentList = document.getElementById('recentTransactions');
            if (recentList) {
                recentList.innerHTML = '';
                recentTransactions.forEach(trans => {
                    const li = document.createElement('li');
                    li.className = 'transaction-item';
                    li.innerHTML = `
                        <div class="transaction-info">
                            <h4>${trans.name}</h4>
                            <p>${trans.date} • Карта **** ${trans.cardLastFour}</p>
                        </div>
                        <div class="transaction-amount ${trans.amount >= 0 ? 'positive' : 'negative'}">
                            ${trans.amount >= 0 ? '+' : ''}${formatCurrency(trans.amount)}
                        </div>
                    `;
                    recentList.appendChild(li);
                });
            }
            
            // Рассчитываем доходы и расходы за месяц
            const now = new Date();
            const currentMonth = now.getMonth();
            const currentYear = now.getFullYear();
            
            let monthlyIncome = 0;
            let monthlyExpenses = 0;
            let incomeTransactions = [];
            let expensesTransactions = [];
            
            allTransactions.forEach(trans => {
                // В реальном приложении здесь была бы проверка по месяцу
                // Для демо используем все транзакции
                if (trans.amount >= 0) {
                    monthlyIncome += trans.amount;
                    incomeTransactions.push(trans);
                } else {
                    monthlyExpenses += Math.abs(trans.amount);
                    expensesTransactions.push(trans);
                }
            });
            
            // Ограничиваем по 3 транзакции для каждого слайда
            incomeTransactions = incomeTransactions.slice(0, 3);
            expensesTransactions = expensesTransactions.slice(0, 3);
            
            // Обновляем слайд доходов
            const incomeList = document.getElementById('incomeTransactions');
            if (incomeList) {
                incomeList.innerHTML = '';
                incomeTransactions.forEach(trans => {
                    const li = document.createElement('li');
                    li.className = 'transaction-item';
                    li.innerHTML = `
                        <div class="transaction-info">
                            <h4>${trans.name}</h4>
                            <p>${trans.date} • Карта **** ${trans.cardLastFour}</p>
                        </div>
                        <div class="transaction-amount positive">
                            +${formatCurrency(trans.amount)}
                        </div>
                    `;
                    incomeList.appendChild(li);
                });
            }
            
            // Обновляем слайд расходов
            const expensesList = document.getElementById('expensesTransactions');
            if (expensesList) {
                expensesList.innerHTML = '';
                expensesTransactions.forEach(trans => {
                    const li = document.createElement('li');
                    li.className = 'transaction-item';
                    li.innerHTML = `
                        <div class="transaction-info">
                            <h4>${trans.name}</h4>
                            <p>${trans.date} • Карта **** ${trans.cardLastFour}</p>
                        </div>
                        <div class="transaction-amount negative">
                            -${formatCurrency(Math.abs(trans.amount))}
                        </div>
                    `;
                    expensesList.appendChild(li);
                });
            }
            
            // Обновляем статистику
            document.getElementById('totalIncome').textContent = formatCurrency(monthlyIncome);
            document.getElementById('incomeCount').textContent = incomeTransactions.length;
            document.getElementById('largestIncome').textContent = incomeTransactions.length > 0 
                ? formatCurrency(Math.max(...incomeTransactions.map(t => t.amount)))
                : '$0';
            
            document.getElementById('totalExpenses').textContent = formatCurrency(monthlyExpenses);
            document.getElementById('expensesCount').textContent = expensesTransactions.length;
            document.getElementById('largestExpense').textContent = expensesTransactions.length > 0
                ? formatCurrency(Math.max(...expensesTransactions.map(t => Math.abs(t.amount))))
                : '$0';
        }
        
        // Функция для загрузки истории переводов
        function loadUserTransfers() {
            if (!currentUser) return;
            
            const user = usersData.find(u => u.email === currentUser.email);
            if (!user) return;
            
            const transfersList = document.getElementById('transfersList');
            const emptyHistory = document.getElementById('emptyHistory');
            
            if (!user.transfers || user.transfers.length === 0) {
                if (emptyHistory) emptyHistory.style.display = 'block';
                return;
            }
            
            if (emptyHistory) emptyHistory.style.display = 'none';
            
            // Сортируем переводы по дате (новые сначала)
            const sortedTransfers = [...user.transfers].sort((a, b) => 
                new Date(b.date) - new Date(a.date)
            ).slice(0, 10); // Ограничиваем 10 последними переводами
            
            transfersList.innerHTML = '';
            
            sortedTransfers.forEach(transfer => {
                const li = document.createElement('li');
                li.className = `transfer-item ${transfer.type}`;
                li.innerHTML = `
                    <div class="transfer-info">
                        <h4>${transfer.type === 'outgoing' ? 'Отправлен перевод' : 'Получен перевод'}</h4>
                        <p>${transfer.date} • ${transfer.note || 'Без примечания'}</p>
                        ${transfer.type === 'outgoing' ? 
                            `<small>Кому: ${transfer.recipientName}</small>` : 
                            `<small>От: ${transfer.senderName}</small>`}
                    </div>
                    <div class="transfer-amount ${transfer.type}">
                        ${transfer.type === 'outgoing' ? '-' : '+'}${formatCurrency(transfer.amount)}
                    </div>
                `;
                transfersList.appendChild(li);
            });
        }
        
        // Функция для обновления выпадающих списков карт
        function updateCardSelects() {
            if (!currentUser) return;
            
            const user = usersData.find(u => u.email === currentUser.email);
            if (!user || !user.cards) return;
            
            // Обновляем все селекты карт
            const cardSelects = [
                'fromCard',
                'depositFromCard'
            ];
            
            cardSelects.forEach(selectId => {
                const select = document.getElementById(selectId);
                if (select) {
                    // Сохраняем текущее значение
                    const currentValue = select.value;
                    
                    // Очищаем опции
                    select.innerHTML = '<option value="">Выберите карту</option>';
                    
                    // Добавляем карты пользователя
                    user.cards.forEach(card => {
                        const option = document.createElement('option');
                        option.value = card.id;
                        option.textContent = `${card.type.toUpperCase()} **** ${card.number.slice(-4)} (${formatCurrency(card.balance)})`;
                        select.appendChild(option);
                    });
                    
                    // Восстанавливаем выбранное значение
                    select.value = currentValue;
                }
            });
        }
        
        // Функция для переключения между разделами
        function switchSection(sectionId) {
            // Скрываем все разделы
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Показываем выбранный раздел
            const targetSection = document.getElementById(sectionId + 'Section');
            if (targetSection) {
                targetSection.classList.add('active');
            }
            
            // Обновляем активную ссылку в навигации
            document.querySelectorAll('.nav-links a').forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('data-section') === sectionId) {
                    link.classList.add('active');
                }
            });
            
            // Если перешли в раздел инвестиций, обновляем данные
            if (sectionId === 'investments') {
                renderCryptoTable();
                updatePortfolio();
                updateLastUpdateTime();
            }
            
            // Прокручиваем к началу раздела
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        
        // Функция для открытия модального окна
        function openModal(modalId) {
            // Закрываем все другие модальные окна
            document.querySelectorAll('.modal').forEach(modal => {
                modal.classList.remove('active');
            });
            
            // Открываем нужное модальное окно
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.add('active');
                document.body.style.overflow = 'hidden';
                
                // Инициализация модального окна в зависимости от типа
                if (modalId === 'addCardModal') {
                    initializeAddCardModal();
                } else if (modalId === 'depositInvestmentModal') {
                    initializeDepositInvestmentModal();
                }
            }
        }
        
        // Функция для закрытия модального окна
        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.remove('active');
                document.body.style.overflow = 'auto';
            }
        }
        
        // Функция для инициализации модального окна добавления карты
        function initializeAddCardModal() {
            // Сбрасываем форму
            const form = document.getElementById('addCardForm');
            if (form) form.reset();
            
            // Сбрасываем превью карты
            document.getElementById('previewCardNumber').textContent = '**** **** **** ****';
            document.getElementById('previewCardExpiry').textContent = 'MM/YY';
            document.getElementById('previewCardBadge').textContent = 'VISA';
            document.getElementById('previewCardType').textContent = 'VISA';
            
            // Обработчик ввода номера карты
            const cardNumberInput = document.getElementById('cardNumber');
            if (cardNumberInput) {
                cardNumberInput.addEventListener('input', function(e) {
                    // Форматируем номер карты (добавляем пробелы через каждые 4 цифры)
                    let value = e.target.value.replace(/\s/g, '').replace(/\D/g, '');
                    let formatted = '';
                    
                    for (let i = 0; i < value.length; i++) {
                        if (i > 0 && i % 4 === 0) {
                            formatted += ' ';
                        }
                        formatted += value[i];
                    }
                    
                    e.target.value = formatted.substring(0, 19);
                    
                    // Обновляем превью
                    const previewNumber = document.getElementById('previewCardNumber');
                    if (value.length >= 16) {
                        const lastFour = value.slice(-4);
                        previewNumber.textContent = `**** **** **** ${lastFour}`;
                    } else {
                        previewNumber.textContent = formatted.padEnd(19, '*').replace(/\*/g, '•');
                    }
                    
                    // Определяем тип карты
                    const cardType = detectCardType(value);
                    const badge = document.getElementById('previewCardBadge');
                    const typeText = document.getElementById('previewCardType');
                    
                    badge.textContent = cardType.toUpperCase();
                    badge.className = `card-type-badge ${cardType}`;
                    typeText.textContent = cardType.toUpperCase();
                    
                    // Обновляем стиль превью карты
                    const preview = document.getElementById('cardPreview');
                    preview.className = `card-preview ${cardType}`;
                });
            }
            
            // Обработчик ввода срока действия
            const expiryInput = document.getElementById('cardExpiry');
            if (expiryInput) {
                expiryInput.addEventListener('input', function(e) {
                    let value = e.target.value.replace(/\D/g, '');
                    
                    if (value.length >= 2) {
                        value = value.substring(0, 2) + '/' + value.substring(2, 4);
                    }
                    
                    e.target.value = value.substring(0, 5);
                    
                    // Обновляем превью
                    document.getElementById('previewCardExpiry').textContent = 
                        value || 'MM/YY';
                });
            }
        }
        
        // Функция для инициализации модального окна пополнения счета
        function initializeDepositInvestmentModal() {
            const form = document.getElementById('depositInvestmentForm');
            if (form) form.reset();
            
            const amountInput = document.getElementById('depositAmount');
            if (amountInput) {
                amountInput.addEventListener('input', updateDepositPreview);
            }
            
            const cardSelect = document.getElementById('depositFromCard');
            if (cardSelect) {
                cardSelect.addEventListener('change', updateDepositPreview);
            }
            
            updateDepositPreview();
        }
        
        // Функция для обновления превью пополнения
        function updateDepositPreview() {
            const amount = parseFloat(document.getElementById('depositAmount')?.value) || 0;
            const cardId = document.getElementById('depositFromCard')?.value;
            
            if (amount <= 0 || !cardId) {
                document.getElementById('depositPreview').classList.remove('active');
                return;
            }
            
            const user = usersData.find(u => u.email === currentUser.email);
            if (!user) return;
            
            const card = user.cards?.find(c => c.id === cardId);
            if (!card) return;
            
            const fee = amount * 0.01; // Комиссия 1%
            const total = amount + fee;
            
            // Обновляем информацию
            document.getElementById('previewDepositFrom').textContent = 
                `${card.type.toUpperCase()} **** ${card.number.slice(-4)}`;
            document.getElementById('previewDepositTo').textContent = 'Инвестиционный счет';
            document.getElementById('previewDepositFee').textContent = formatCurrency(fee);
            document.getElementById('previewDepositTotal').textContent = formatCurrency(total);
            
            // Проверяем, достаточно ли средств на карте
            if (parseFloat(card.balance) < total) {
                document.getElementById('previewDepositTotal').style.color = 'var(--danger)';
                document.getElementById('previewDepositTotal').innerHTML += 
                    ' <i class="fas fa-exclamation-triangle" title="Недостаточно средств на карте"></i>';
            } else {
                document.getElementById('previewDepositTotal').style.color = '';
            }
            
            document.getElementById('depositPreview').classList.add('active');
        }
        
        // Функция для запуска автоматического обновления цен криптовалют
        function startCryptoPriceUpdates() {
            // Останавливаем предыдущий интервал, если он был
            if (cryptoPriceUpdateInterval) {
                clearInterval(cryptoPriceUpdateInterval);
            }
            
            // Запускаем обновление каждые 30 секунд
            cryptoPriceUpdateInterval = setInterval(() => {
                if (document.getElementById('investmentsSection').classList.contains('active')) {
                    updateCryptoPrices();
                }
            }, 30000);
        }
        
        // Функция для остановки автоматического обновления цен
        function stopCryptoPriceUpdates() {
            if (cryptoPriceUpdateInterval) {
                clearInterval(cryptoPriceUpdateInterval);
                cryptoPriceUpdateInterval = null;
            }
        }
        
        // Функция для обработки входа пользователя
        function handleLogin(email, password) {
            const user = usersData.find(u => u.email === email && u.password === password);
            
            if (user) {
                // Успешный вход
                currentUser = {
                    email: user.email,
                    firstName: user.firstName,
                    lastName: user.lastName,
                    phone: user.phone
                };
                
                // Сохраняем данные о входе в localStorage
                localStorage.setItem('bankCurrentUser', JSON.stringify(currentUser));
                
                // Обновляем интерфейс
                updateUIForUser();
                
                // Закрываем модальное окно
                closeModal('loginModal');
                
                // Показываем уведомление
                showNotification('Добро пожаловать!', `${user.firstName}, вы успешно вошли в систему`, 'success');
                
                // Переходим в раздел карт
                setTimeout(() => switchSection('cards'), 500);
                
                return true;
            } else {
                // Ошибка входа
                showNotification('Ошибка', 'Неверный email или пароль', 'error');
                return false;
            }
        }
        
        // Функция для обработки регистрации
        function handleRegistration(userData) {
            // Проверяем, существует ли пользователь с таким email
            const existingUser = usersData.find(u => u.email === userData.email);
            
            if (existingUser) {
                showNotification('Ошибка', 'Пользователь с таким email уже существует', 'error');
                return false;
            }
            
            // Проверяем сложность пароля
            const passwordStrength = checkPasswordStrength(userData.password);
            if (passwordStrength.strength < 3) {
                showNotification('Ошибка', 'Пароль слишком слабый', 'error');
                return false;
            }
            
            // Проверяем совпадение паролей
            if (userData.password !== userData.confirmPassword) {
                showNotification('Ошибка', 'Пароли не совпадают', 'error');
                return false;
            }
            
            // Создаем нового пользователя
            const newUser = {
                id: 'user_' + Date.now(),
                firstName: userData.firstName,
                lastName: userData.lastName,
                email: userData.email,
                phone: userData.phone,
                password: userData.password,
                cards: [],
                transfers: [],
                investmentBalance: 0,
                cryptoPortfolio: [],
                tradeHistory: []
            };
            
            // Добавляем пользователя в данные
            usersData.push(newUser);
            saveUsersData();
            
            // Автоматически входим
            currentUser = {
                email: newUser.email,
                firstName: newUser.firstName,
                lastName: newUser.lastName,
                phone: newUser.phone
            };
            
            localStorage.setItem('bankCurrentUser', JSON.stringify(currentUser));
            
            // Обновляем интерфейс
            updateUIForUser();
            
            // Закрываем модальное окно
            closeModal('registrationModal');
            
            // Показываем уведомление
            showNotification('Регистрация успешна!', `Добро пожаловать, ${newUser.firstName}!`, 'success');
            
            // Переходим в раздел карт
            setTimeout(() => switchSection('cards'), 500);
            
            return true;
        }
        
        // Функция для обработки выхода
        function handleLogout() {
            if (confirm('Вы уверены, что хотите выйти?')) {
                currentUser = null;
                localStorage.removeItem('bankCurrentUser');
                
                updateUIForUser();
                switchSection('home');
                
                showNotification('Выход', 'Вы успешно вышли из системы', 'success');
            }
        }
        
        // Функция для добавления новой карты
        function handleAddCard(cardData) {
            if (!currentUser) return false;
            
            const userIndex = usersData.findIndex(u => u.email === currentUser.email);
            if (userIndex === -1) return false;
            
            const user = usersData[userIndex];
            
            // Создаем новую карту
            const newCard = {
                id: 'card_' + Date.now(),
                number: cardData.number.replace(/\s/g, ''),
                expiry: cardData.expiry,
                cvc: cardData.cvc,
                balance: parseFloat(cardData.balance) || 0,
                type: detectCardType(cardData.number),
                transactions: []
            };
            
            // Добавляем карту пользователю
            if (!user.cards) user.cards = [];
            user.cards.push(newCard);
            
            // Обновляем данные
            usersData[userIndex] = user;
            saveUsersData();
            
            // Обновляем интерфейс
            loadUserCards();
            updateCardSelects();
            
            // Закрываем модальное окно
            closeModal('addCardModal');
            
            // Показываем уведомление
            showNotification('Карта добавлена', 'Новая карта успешно добавлена', 'success');
            
            return true;
        }
        
        // Функция для выполнения перевода
        function handleTransfer(transferData) {
            if (!currentUser) return false;
            
            const userIndex = usersData.findIndex(u => u.email === currentUser.email);
            if (userIndex === -1) return false;
            
            const user = usersData[userIndex];
            
            // Находим карту отправителя
            const fromCard = user.cards?.find(c => c.id === transferData.fromCard);
            if (!fromCard) {
                showNotification('Ошибка', 'Карта отправителя не найдена', 'error');
                return false;
            }
            
            // Проверяем, достаточно ли средств
            const amount = parseFloat(transferData.amount);
            const fee = amount * 0.015; // Комиссия 1.5%
            const total = amount + fee;
            
            if (parseFloat(fromCard.balance) < total) {
                showNotification('Ошибка', 'Недостаточно средств на карте', 'error');
                return false;
            }
            
            // Находим получателя
            const recipient = usersData.find(u => u.email === transferData.recipientEmail);
            if (!recipient) {
                showNotification('Ошибка', 'Получатель не найден', 'error');
                return false;
            }
            
            // Находим карту получателя
            const toCard = recipient.cards?.[0]; // Для простоты берем первую карту
            if (!toCard) {
                showNotification('Ошибка', 'У получателя нет карт', 'error');
                return false;
            }
            
            // Выполняем перевод
            // Списание у отправителя
            fromCard.balance = (parseFloat(fromCard.balance) - total).toFixed(2);
            
            // Зачисление получателю
            toCard.balance = (parseFloat(toCard.balance) + amount).toFixed(2);
            
            // Добавляем транзакции
            const transactionDate = new Date().toLocaleDateString('ru-RU', { day: 'numeric', month: 'long' });
            
            // У отправителя
            if (!fromCard.transactions) fromCard.transactions = [];
            fromCard.transactions.push({
                id: 'trans_' + Date.now() + '_out',
                name: `Перевод ${recipient.firstName} ${recipient.lastName}`,
                date: transactionDate,
                amount: -total,
                type: 'expense',
                category: 'Перевод'
            });
            
            // У получателя
            if (!toCard.transactions) toCard.transactions = [];
            toCard.transactions.push({
                id: 'trans_' + Date.now() + '_in',
                name: `Перевод от ${user.firstName} ${user.lastName}`,
                date: transactionDate,
                amount: amount,
                type: 'income',
                category: 'Перевод'
            });
            
            // Добавляем запись в историю переводов отправителя
            if (!user.transfers) user.transfers = [];
            user.transfers.push({
                id: 'transfer_' + Date.now(),
                date: new Date().toLocaleString('ru-RU'),
                type: 'outgoing',
                amount: amount,
                fee: fee,
                recipientName: `${recipient.firstName} ${recipient.lastName}`,
                recipientEmail: recipient.email,
                note: transferData.note || '',
                cardLastFour: fromCard.number.slice(-4)
            });
            
            // Добавляем запись в историю переводов получателя
            if (!recipient.transfers) recipient.transfers = [];
            recipient.transfers.push({
                id: 'transfer_' + Date.now() + '_in',
                date: new Date().toLocaleString('ru-RU'),
                type: 'incoming',
                amount: amount,
                senderName: `${user.firstName} ${user.lastName}`,
                senderEmail: user.email,
                note: transferData.note || '',
                cardLastFour: toCard.number.slice(-4)
            });
            
            // Обновляем данные
            usersData[userIndex] = user;
            const recipientIndex = usersData.findIndex(u => u.email === recipient.email);
            if (recipientIndex !== -1) {
                usersData[recipientIndex] = recipient;
            }
            
            saveUsersData();
            
            // Обновляем интерфейс
            loadUserCards();
            loadUserTransfers();
            updateCardSelects();
            
            // Очищаем форму
            const form = document.getElementById('transferForm');
            if (form) form.reset();
            document.getElementById('transferPreview').classList.remove('active');
            document.getElementById('toCard').disabled = true;
            
            // Показываем уведомление
            showNotification('Перевод выполнен', 
                `${formatCurrency(amount)} успешно переведены`, 
                'success');
            
            return true;
        }
        
        // Функция для пополнения инвестиционного счета
        function handleDepositInvestment(depositData) {
            if (!currentUser) return false;
            
            const userIndex = usersData.findIndex(u => u.email === currentUser.email);
            if (userIndex === -1) return false;
            
            const user = usersData[userIndex];
            
            // Находим карту
            const card = user.cards?.find(c => c.id === depositData.fromCard);
            if (!card) {
                showNotification('Ошибка', 'Карта не найдена', 'error');
                return false;
            }
            
            const amount = parseFloat(depositData.amount);
            const fee = amount * 0.01; // Комиссия 1%
            const total = amount + fee;
            
            // Проверяем, достаточно ли средств
            if (parseFloat(card.balance) < total) {
                showNotification('Ошибка', 'Недостаточно средств на карте', 'error');
                return false;
            }
            
            // Выполняем перевод
            card.balance = (parseFloat(card.balance) - total).toFixed(2);
            user.investmentBalance = (parseFloat(user.investmentBalance || 0) + amount).toFixed(2);
            
            // Добавляем транзакцию на карту
            if (!card.transactions) card.transactions = [];
            card.transactions.push({
                id: 'trans_' + Date.now(),
                name: 'Пополнение инвестиционного счета',
                date: new Date().toLocaleDateString('ru-RU', { day: 'numeric', month: 'long' }),
                amount: -total,
                type: 'expense',
                category: 'Инвестиции'
            });
            
            // Обновляем данные
            usersData[userIndex] = user;
            saveUsersData();
            
            // Обновляем интерфейс
            loadUserCards();
            updatePortfolio();
            updateCardSelects();
            
            // Закрываем модальное окно
            closeModal('depositInvestmentModal');
            
            // Показываем уведомление
            showNotification('Счет пополнен', 
                `${formatCurrency(amount)} успешно зачислены на инвестиционный счет`, 
                'success');
            
            return true;
        }
        
        // Инициализация при загрузке страницы
        document.addEventListener('DOMContentLoaded', function() {
            // Загружаем данные
            loadUsersData();
            
            // Проверяем, есть ли сохраненный пользователь
            const savedUser = localStorage.getItem('bankCurrentUser');
            if (savedUser) {
                try {
                    currentUser = JSON.parse(savedUser);
                    // Проверяем, существует ли пользователь в данных
                    const userExists = usersData.some(u => u.email === currentUser.email);
                    if (!userExists) {
                        currentUser = null;
                        localStorage.removeItem('bankCurrentUser');
                    }
                } catch (e) {
                    currentUser = null;
                    localStorage.removeItem('bankCurrentUser');
                }
            }
            
            // Обновляем интерфейс в соответствии с состоянием пользователя
            updateUIForUser();
            
            // Инициализируем карусель транзакций
            initTransactionsCarousel();
            
            // Настраиваем обработчики событий
            
            // Навигация
            document.querySelectorAll('.nav-links a[data-section]').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const section = this.getAttribute('data-section');
                    switchSection(section);
                });
            });
            
            // Логотип ведет на главную
            document.querySelector('.logo').addEventListener('click', function(e) {
                e.preventDefault();
                switchSection('home');
            });
            
            // Кнопки авторизации
            document.getElementById('loginBtn')?.addEventListener('click', () => openModal('loginModal'));
            document.getElementById('registerBtn')?.addEventListener('click', () => openModal('registrationModal'));
            document.getElementById('heroRegisterBtn')?.addEventListener('click', () => openModal('registrationModal'));
            document.getElementById('logoutBtn')?.addEventListener('click', handleLogout);
            
            // Форма входа
            document.getElementById('loginForm')?.addEventListener('submit', function(e) {
                e.preventDefault();
                const email = document.getElementById('loginEmail').value;
                const password = document.getElementById('loginPassword').value;
                handleLogin(email, password);
            });
            
            // Форма регистрации
            document.getElementById('registrationForm')?.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const userData = {
                    firstName: document.getElementById('firstName').value,
                    lastName: document.getElementById('lastName').value,
                    email: document.getElementById('email').value,
                    phone: document.getElementById('phone').value,
                    password: document.getElementById('password').value,
                    confirmPassword: document.getElementById('confirmPassword').value
                };
                
                handleRegistration(userData);
            });
            
            // Проверка сложности пароля при вводе
            const passwordInput = document.getElementById('password');
            if (passwordInput) {
                passwordInput.addEventListener('input', function() {
                    const strength = checkPasswordStrength(this.value);
                    const strengthElement = document.getElementById('passwordStrength');
                    if (strengthElement) {
                        strengthElement.textContent = `Сложность: ${strength.text}`;
                        strengthElement.className = `password-strength ${strength.className}`;
                    }
                });
            }
            
            // Переключение между формами входа и регистрации
            document.getElementById('goToRegister')?.addEventListener('click', function(e) {
                e.preventDefault();
                closeModal('loginModal');
                openModal('registrationModal');
            });
            
            document.getElementById('goToLogin')?.addEventListener('click', function(e) {
                e.preventDefault();
                closeModal('registrationModal');
                openModal('loginModal');
            });
            
            // Закрытие модальных окон
            document.querySelectorAll('.close-modal').forEach(btn => {
                btn.addEventListener('click', function() {
                    const modal = this.closest('.modal');
                    if (modal) {
                        modal.classList.remove('active');
                        document.body.style.overflow = 'auto';
                    }
                });
            });
            
            // Закрытие модальных окон при клике на фон
            document.querySelectorAll('.modal').forEach(modal => {
                modal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        this.classList.remove('active');
                        document.body.style.overflow = 'auto';
                    }
                });
            });
            
            // Добавление карты
            document.getElementById('addCardBtn')?.addEventListener('click', () => openModal('addCardModal'));
            
            // Форма добавления карты
            document.getElementById('addCardForm')?.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const cardData = {
                    number: document.getElementById('cardNumber').value,
                    expiry: document.getElementById('cardExpiry').value,
                    cvc: document.getElementById('cardCvc').value,
                    balance: document.getElementById('cardBalance').value || '0'
                };
                
                handleAddCard(cardData);
            });
            
            // Переводы
            const transferForm = document.getElementById('transferForm');
            if (transferForm) {
                transferForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const transferData = {
                        fromCard: document.getElementById('fromCard').value,
                        recipientEmail: document.getElementById('recipientEmail').value,
                        amount: document.getElementById('transferAmount').value,
                        note: document.getElementById('transferNote').value
                    };
                    
                    handleTransfer(transferData);
                });
                
                // Поиск пользователей при вводе email
                const recipientInput = document.getElementById('recipientEmail');
                if (recipientInput) {
                    recipientInput.addEventListener('input', function() {
                        const searchTerm = this.value.toLowerCase();
                        const resultsContainer = document.getElementById('userSearchResults');
                        
                        if (searchTerm.length < 2) {
                            resultsContainer.classList.remove('active');
                            return;
                        }
                        
                        // Ищем пользователей (исключая текущего)
                        const filteredUsers = usersData.filter(user => 
                            user.email.toLowerCase().includes(searchTerm) ||
                            `${user.firstName} ${user.lastName}`.toLowerCase().includes(searchTerm)
                        ).filter(user => !currentUser || user.email !== currentUser.email);
                        
                        // Отображаем результаты
                        resultsContainer.innerHTML = '';
                        
                        if (filteredUsers.length === 0) {
                            const noResult = document.createElement('div');
                            noResult.className = 'user-result';
                            noResult.innerHTML = '<div style="padding: 15px; text-align: center; color: var(--text-secondary);">Пользователь не найден</div>';
                            resultsContainer.appendChild(noResult);
                        } else {
                            filteredUsers.forEach(user => {
                                const result = document.createElement('div');
                                result.className = 'user-result';
                                result.dataset.email = user.email;
                                result.innerHTML = `
                                    <div class="user-avatar-small">
                                        ${user.firstName[0]}${user.lastName[0]}
                                    </div>
                                    <div class="user-result-info">
                                        <div class="user-result-name">${user.firstName} ${user.lastName}</div>
                                        <div class="user-result-email">${user.email}</div>
                                    </div>
                                `;
                                
                                result.addEventListener('click', function() {
                                    recipientInput.value = user.email;
                                    resultsContainer.classList.remove('active');
                                    
                                    // Обновляем селект карт получателя
                                    const toCardSelect = document.getElementById('toCard');
                                    if (toCardSelect && user.cards && user.cards.length > 0) {
                                        toCardSelect.innerHTML = '';
                                        user.cards.forEach(card => {
                                            const option = document.createElement('option');
                                            option.value = card.id;
                                            option.textContent = `${card.type.toUpperCase()} **** ${card.number.slice(-4)}`;
                                            toCardSelect.appendChild(option);
                                        });
                                        toCardSelect.disabled = false;
                                    }
                                    
                                    // Показываем превью перевода
                                    updateTransferPreview();
                                });
                                
                                resultsContainer.appendChild(result);
                            });
                        }
                        
                        resultsContainer.classList.add('active');
                    });
                    
                    // Скрываем результаты при клике вне поля
                    document.addEventListener('click', function(e) {
                        if (!recipientInput.contains(e.target) && 
                            !document.getElementById('userSearchResults').contains(e.target)) {
                            document.getElementById('userSearchResults').classList.remove('active');
                        }
                    });
                }
                
                // Обновление превью перевода при изменении данных
                ['fromCard', 'toCard', 'transferAmount'].forEach(id => {
                    document.getElementById(id)?.addEventListener('change', updateTransferPreview);
                    document.getElementById(id)?.addEventListener('input', updateTransferPreview);
                });
            }
            
            // Инвестиции
            document.getElementById('refreshPricesBtn')?.addEventListener('click', function() {
                this.disabled = true;
                this.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Обновление...';
                
                setTimeout(() => {
                    updateCryptoPrices();
                    this.disabled = false;
                    this.innerHTML = '<i class="fas fa-sync-alt"></i> Обновить';
                    showNotification('Обновлено', 'Цены криптовалют обновлены', 'success');
                }, 1000);
            });
            
            document.getElementById('depositInvestmentBtn')?.addEventListener('click', () => {
                openModal('depositInvestmentModal');
            });
            
            // Форма пополнения инвестиционного счета
            document.getElementById('depositInvestmentForm')?.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const depositData = {
                    fromCard: document.getElementById('depositFromCard').value,
                    amount: document.getElementById('depositAmount').value
                };
                
                handleDepositInvestment(depositData);
            });
            
            // Торговля
            document.querySelectorAll('.trade-type-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.trade-type-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    
                    tradeType = this.getAttribute('data-type');
                    if (selectedCrypto) {
                        updateTradePanel();
                    }
                });
            });
            
            document.getElementById('cryptoAmount')?.addEventListener('input', updateTradeCalculations);
            
            document.querySelectorAll('.amount-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const percent = parseFloat(this.getAttribute('data-percent'));
                    
                    if (tradeType === 'buy') {
                        const user = usersData.find(u => u.email === currentUser.email);
                        if (!user) return;
                        
                        const availableBalance = user.investmentBalance || 0;
                        const cryptoPrice = selectedCrypto.price;
                        const maxAmount = (availableBalance * percent) / cryptoPrice;
                        
                        document.getElementById('cryptoAmount').value = maxAmount.toFixed(6);
                    } else {
                        const user = usersData.find(u => u.email === currentUser.email);
                        if (!user) return;
                        
                        const portfolioItem = user.cryptoPortfolio?.find(item => item.id === selectedCrypto.id);
                        if (!portfolioItem) return;
                        
                        document.getElementById('cryptoAmount').value = (portfolioItem.amount * percent).toFixed(6);
                    }
                    
                    updateTradeCalculations();
                });
            });
            
            document.getElementById('executeTradeBtn')?.addEventListener('click', function() {
                if (!selectedCrypto) return;
                
                // Показываем модальное окно подтверждения
                const amount = parseFloat(document.getElementById('cryptoAmount').value);
                const price = selectedCrypto.price;
                const total = amount * price;
                const fee = total * 0.001;
                const totalWithFee = tradeType === 'buy' ? total + fee : total - fee;
                
                const summary = document.getElementById('tradeSummary');
                summary.innerHTML = `
                    <div class="transfer-details">
                        <div class="transfer-detail">
                            <span class="transfer-label">Тип операции:</span>
                            <span class="transfer-value">${tradeType === 'buy' ? 'Покупка' : 'Продажа'}</span>
                        </div>
                        <div class="transfer-detail">
                            <span class="transfer-label">Криптовалюта:</span>
                            <span class="transfer-value">${selectedCrypto.name} (${selectedCrypto.symbol})</span>
                        </div>
                        <div class="transfer-detail">
                            <span class="transfer-label">Количество:</span>
                            <span class="transfer-value">${amount.toFixed(6)} ${selectedCrypto.symbol}</span>
                        </div>
                        <div class="transfer-detail">
                            <span class="transfer-label">Цена:</span>
                            <span class="transfer-value">${formatCurrency(price, 2)}</span>
                        </div>
                        <div class="transfer-detail">
                            <span class="transfer-label">Сумма:</span>
                            <span class="transfer-value">${formatCurrency(total, 2)}</span>
                        </div>
                        <div class="transfer-detail">
                            <span class="transfer-label">Комиссия (0.1%):</span>
                            <span class="transfer-value">${formatCurrency(fee, 2)}</span>
                        </div>
                        <div class="transfer-detail">
                            <span class="transfer-label">Итого:</span>
                            <span class="transfer-value" style="font-size: 1.2rem; font-weight: 700; color: ${tradeType === 'buy' ? 'var(--success)' : 'var(--danger)'}">
                                ${tradeType === 'buy' ? '-' : '+'}${formatCurrency(totalWithFee, 2)}
                            </span>
                        </div>
                    </div>
                `;
                
                document.getElementById('tradeConfirmTitle').textContent = 
                    `Подтверждение ${tradeType === 'buy' ? 'покупки' : 'продажи'}`;
                
                openModal('tradeConfirmModal');
            });
            
            document.getElementById('confirmTradeBtn')?.addEventListener('click', function() {
                const password = document.getElementById('tradePassword').value;
                
                if (!currentUser) return;
                
                const user = usersData.find(u => u.email === currentUser.email);
                if (!user || user.password !== password) {
                    showNotification('Ошибка', 'Неверный пароль', 'error');
                    return;
                }
                
                executeTrade();
            });
            
            document.getElementById('refreshPortfolioBtn')?.addEventListener('click', function() {
                this.disabled = true;
                this.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Обновление...';
                
                setTimeout(() => {
                    updatePortfolio();
                    this.disabled = false;
                    this.innerHTML = '<i class="fas fa-sync-alt"></i> Обновить';
                    showNotification('Обновлено', 'Портфель обновлен', 'success');
                }, 500);
            });
            
            // Ссылки в футере
            document.querySelectorAll('footer a[data-section]').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const section = this.getAttribute('data-section');
                    switchSection(section);
                });
            });
            
            // Инициализация цен криптовалют
            renderCryptoTable();
            updateLastUpdateTime();
        });
        
        // Функция для инициализации карусели транзакций
        function initTransactionsCarousel() {
            const slides = document.querySelectorAll('.carousel-slide');
            const indicators = document.querySelectorAll('.indicator');
            const prevBtn = document.getElementById('prevSlide');
            const nextBtn = document.getElementById('nextSlide');
            
            if (!slides.length) return;
            
            totalSlides = slides.length;
            
            function showSlide(index) {
                // Проверяем границы
                if (index < 0) index = totalSlides - 1;
                if (index >= totalSlides) index = 0;
                
                // Скрываем все слайды
                slides.forEach(slide => {
                    slide.classList.remove('active', 'prev');
                });
                
                // Показываем текущий слайд
                slides[index].classList.add('active');
                
                // Обновляем индикаторы
                indicators.forEach((indicator, i) => {
                    indicator.classList.remove('active');
                    if (i === index) indicator.classList.add('active');
                });
                
                currentSlide = index;
                
                // Обновляем состояние кнопок
                if (prevBtn) prevBtn.disabled = false;
                if (nextBtn) nextBtn.disabled = false;
            }
            
            // Обработчики для кнопок
            if (prevBtn) {
                prevBtn.addEventListener('click', () => {
                    showSlide(currentSlide - 1);
                });
            }
            
            if (nextBtn) {
                nextBtn.addEventListener('click', () => {
                    showSlide(currentSlide + 1);
                });
            }
            
            // Обработчики для индикаторов
            indicators.forEach((indicator, index) => {
                indicator.addEventListener('click', () => {
                    showSlide(index);
                });
            });
            
            // Автопрокрутка
            carouselInterval = setInterval(() => {
                showSlide(currentSlide + 1);
            }, 5000);
            
            // Останавливаем автопрокрутку при наведении
            const carousel = document.querySelector('.transactions-carousel');
            if (carousel) {
                carousel.addEventListener('mouseenter', () => {
                    clearInterval(carouselInterval);
                });
                
                carousel.addEventListener('mouseleave', () => {
                    carouselInterval = setInterval(() => {
                        showSlide(currentSlide + 1);
                    }, 5000);
                });
            }
            
            // Показываем первый слайд
            showSlide(0);
        }
        
        // Функция для обновления превью перевода
        function updateTransferPreview() {
            const fromCardId = document.getElementById('fromCard')?.value;
            const toCardId = document.getElementById('toCard')?.value;
            const amount = parseFloat(document.getElementById('transferAmount')?.value) || 0;
            
            if (!fromCardId || !toCardId || amount <= 0) {
                document.getElementById('transferPreview').classList.remove('active');
                return;
            }
            
            const user = usersData.find(u => u.email === currentUser.email);
            if (!user) return;
            
            const fromCard = user.cards?.find(c => c.id === fromCardId);
            if (!fromCard) return;
            
            // Находим получателя по карте
            let recipient = null;
            let recipientCard = null;
            
            for (const u of usersData) {
                if (u.cards) {
                    const card = u.cards.find(c => c.id === toCardId);
                    if (card) {
                        recipient = u;
                        recipientCard = card;
                        break;
                    }
                }
            }
            
            if (!recipient || !recipientCard) return;
            
            const fee = amount * 0.015; // Комиссия 1.5%
            const total = amount + fee;
            
            // Обновляем информацию
            document.getElementById('previewFrom').textContent = 
                `${fromCard.type.toUpperCase()} **** ${fromCard.number.slice(-4)}`;
            document.getElementById('previewTo').textContent = 
                `${recipient.firstName} ${recipient.lastName} (${recipientCard.type.toUpperCase()} **** ${recipientCard.number.slice(-4)})`;
            document.getElementById('previewAmount').textContent = formatCurrency(amount);
            document.getElementById('previewFee').textContent = formatCurrency(fee);
            document.getElementById('previewTotal').textContent = formatCurrency(total);
            
            // Проверяем, достаточно ли средств
            if (parseFloat(fromCard.balance) < total) {
                document.getElementById('previewTotal').style.color = 'var(--danger)';
                document.getElementById('previewTotal').innerHTML += 
                    ' <i class="fas fa-exclamation-triangle" title="Недостаточно средств на карте"></i>';
            } else {
                document.getElementById('previewTotal').style.color = '';
            }
            
            document.getElementById('transferPreview').classList.add('active');
        }
    </script>
</body>
</html>